<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SMX KITS - Instructor Command Center</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css' rel='stylesheet' />
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="js/instructor-dashboard-sections.js"></script>
  <script src="js/instructor-dashboard-enhanced.js"></script>
  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --accent-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --dark-gradient: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 100%);
      --card-gradient: linear-gradient(145deg, #16213e 0%, #0f1419 100%);
      --glass-bg: rgba(255, 255, 255, 0.05);
      --glass-border: rgba(255, 255, 255, 0.1);
      --text-primary: #ffffff;
      --text-secondary: #b8c5d6;
      --text-accent: #64b5f6;
      --shadow-primary: 0 20px 40px rgba(0, 0, 0, 0.3);
      --shadow-hover: 0 30px 60px rgba(0, 0, 0, 0.4);
      --border-radius: 20px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --success-color: #22c55e;
      --warning-color: #f59e0b;
      --error-color: #ef4444;
      --info-color: #3b82f6;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--dark-gradient);
      color: var(--text-primary);
      overflow-x: hidden;
      line-height: 1.6;
      min-height: 100vh;
    }

    /* Animated background particles */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.1) 0%, transparent 50%);
      z-index: -1;
      animation: float 20s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      33% { transform: translateY(-20px) rotate(1deg); }
      66% { transform: translateY(10px) rotate(-1deg); }
    }

    /* Main Layout */
    .dashboard-container {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 280px;
      background: rgba(15, 20, 25, 0.95);
      backdrop-filter: blur(20px);
      border-right: 1px solid var(--glass-border);
      display: flex;
      flex-direction: column;
      padding: 2rem 0;
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      z-index: 100;
    }

    .sidebar::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(180deg, rgba(102, 126, 234, 0.1) 0%, transparent 100%);
      z-index: -1;
    }

    .logo {
      width: 200px;
      margin: 0 auto 3rem;
      filter: drop-shadow(0 10px 30px rgba(102, 126, 234, 0.3));
      transition: var(--transition);
    }

    .logo:hover {
      transform: scale(1.05);
      filter: drop-shadow(0 15px 40px rgba(102, 126, 234, 0.5));
    }

    .nav-menu {
      list-style: none;
      padding: 0 1rem;
      flex: 1;
    }

    .nav-item {
      margin-bottom: 0.5rem;
      padding: 1rem 1.5rem;
      border-radius: 15px;
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .nav-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: var(--primary-gradient);
      transition: var(--transition);
      z-index: -1;
    }

    .nav-item:hover::before,
    .nav-item.active::before {
      left: 0;
    }

    .nav-item:hover,
    .nav-item.active {
      color: white;
      transform: translateX(5px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
    }

    .nav-item i {
      width: 20px;
      text-align: center;
    }

    /* User Info */
    .user-info {
      padding: 1rem;
      margin: 1rem;
      background: var(--glass-bg);
      border-radius: 15px;
      border: 1px solid var(--glass-border);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--accent-gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1rem;
    }

    .user-details h4 {
      font-size: 0.9rem;
      margin-bottom: 2px;
    }

    .user-details span {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    /* Main Content */
    .main-content {
      flex: 1;
      margin-left: 280px;
      padding: 2rem;
      overflow-y: auto;
      max-height: 100vh;
    }

    /* Header */
    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding: 2rem;
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border-radius: var(--border-radius);
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-primary);
    }

    .header-left h1 {
      font-size: 2.5rem;
      font-weight: 800;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
    }

    .header-subtitle {
      color: var(--text-secondary);
      font-size: 1rem;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    /* Class Tabs (Admin Only) */
    .class-tabs {
      display: none;
      margin-bottom: 2rem;
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border-radius: var(--border-radius);
      border: 1px solid var(--glass-border);
      padding: 1rem;
    }

    .class-tabs.show {
      display: block;
    }

    .tab-list {
      display: flex;
      gap: 1rem;
      overflow-x: auto;
      padding-bottom: 0.5rem;
    }

    .tab-button {
      background: transparent;
      border: 1px solid var(--glass-border);
      color: var(--text-secondary);
      padding: 0.75rem 1.5rem;
      border-radius: 10px;
      cursor: pointer;
      transition: var(--transition);
      white-space: nowrap;
      font-weight: 500;
    }

    .tab-button.active {
      background: var(--primary-gradient);
      color: white;
      border-color: transparent;
    }

    .tab-button:hover:not(.active) {
      background: var(--glass-bg);
      color: var(--text-primary);
    }

    /* Dashboard Grid */
    .dashboard-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    /* Live Stream Control */
    .stream-control {
      background: var(--card-gradient);
      border-radius: var(--border-radius);
      padding: 2rem;
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-primary);
    }

    .stream-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .stream-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .stream-status {
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .stream-status.offline {
      background: rgba(239, 68, 68, 0.2);
      color: #fca5a5;
      border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .stream-status.live {
      background: rgba(34, 197, 94, 0.2);
      color: #86efac;
      border: 1px solid rgba(34, 197, 94, 0.3);
    }

    .stream-preview {
      width: 100%;
      height: 300px;
      background: #000;
      border-radius: 10px;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-secondary);
      font-size: 1.1rem;
    }

    .stream-controls {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: var(--primary-gradient);
      color: white;
    }

    .btn-success {
      background: var(--success-color);
      color: white;
    }

    .btn-danger {
      background: var(--error-color);
      color: white;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
    }

    /* Student Activity Panel */
    .activity-panel {
      background: var(--card-gradient);
      border-radius: var(--border-radius);
      padding: 2rem;
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-primary);
    }

    .panel-title {
      font-size: 1.3rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      color: var(--text-accent);
    }

    .student-list {
      max-height: 400px;
      overflow-y: auto;
    }

    .student-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem;
      margin-bottom: 0.5rem;
      background: var(--glass-bg);
      border-radius: 10px;
      border: 1px solid var(--glass-border);
      transition: var(--transition);
    }

    .student-item:hover {
      background: rgba(102, 126, 234, 0.1);
    }

    .student-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .student-avatar {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      background: var(--accent-gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 0.9rem;
    }

    .student-details h4 {
      font-size: 0.9rem;
      margin-bottom: 2px;
    }

    .student-details span {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    .activity-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-left: 1rem;
    }

    .activity-indicator.online {
      background: var(--success-color);
      box-shadow: 0 0 10px rgba(34, 197, 94, 0.5);
    }

    .activity-indicator.away {
      background: var(--warning-color);
    }

    .activity-indicator.offline {
      background: var(--text-secondary);
    }

    /* Quick Stats */
    .quick-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      text-align: center;
      transition: var(--transition);
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-hover);
    }

    .stat-value {
      font-size: 2rem;
      font-weight: bold;
      background: var(--accent-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
    }

    .stat-label {
      color: var(--text-secondary);
      font-size: 0.9rem;
      font-weight: 500;
    }

    /* Content Management */
    .content-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .content-card {
      background: var(--card-gradient);
      border-radius: var(--border-radius);
      padding: 2rem;
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-primary);
    }

    .content-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .content-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .content-list {
      max-height: 300px;
      overflow-y: auto;
    }

    .content-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      margin-bottom: 0.5rem;
      background: var(--glass-bg);
      border-radius: 10px;
      border: 1px solid var(--glass-border);
      transition: var(--transition);
    }

    .content-item:hover {
      background: rgba(102, 126, 234, 0.1);
    }

    /* Messaging Panel */
    .messaging-panel {
      position: fixed;
      right: -400px;
      top: 0;
      width: 400px;
      height: 100vh;
      background: var(--card-gradient);
      backdrop-filter: blur(20px);
      border-left: 1px solid var(--glass-border);
      transition: var(--transition);
      z-index: 200;
      display: flex;
      flex-direction: column;
    }

    .messaging-panel.open {
      right: 0;
    }

    .messaging-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--glass-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .messaging-content {
      flex: 1;
      padding: 1rem;
      overflow-y: auto;
    }

    .message-item {
      padding: 1rem;
      margin-bottom: 1rem;
      background: var(--glass-bg);
      border-radius: 10px;
      border: 1px solid var(--glass-border);
    }

    .message-sender {
      font-weight: 600;
      color: var(--text-accent);
      margin-bottom: 0.5rem;
    }

    .message-text {
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }

    .message-time {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    .message-input {
      padding: 1rem;
      border-top: 1px solid var(--glass-border);
      display: flex;
      gap: 1rem;
    }

    .message-input input {
      flex: 1;
      padding: 0.75rem;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 10px;
      color: var(--text-primary);
      outline: none;
    }

    .message-input input::placeholder {
      color: var(--text-secondary);
    }

    /* Notification Badge */
    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: var(--error-color);
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 0.7rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background: var(--card-gradient);
      backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: var(--border-radius);
      padding: 2rem;
      max-width: 800px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow-hover);
      transform: scale(0.9) translateY(20px);
      transition: all 0.3s ease;
    }

    .modal-overlay.active .modal-content {
      transform: scale(1) translateY(0);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--glass-border);
    }

    .modal-title {
      color: var(--text-accent);
      font-size: 1.5rem;
      font-weight: 600;
      margin: 0;
    }

    .modal-close {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 5px;
      border-radius: 50%;
      width: 35px;
      height: 35px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .modal-close:hover {
      background: var(--glass-bg);
      color: var(--text-primary);
    }

    /* Form Styles */
    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 0.75rem;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 10px;
      color: var(--text-primary);
      outline: none;
      transition: var(--transition);
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      border-color: var(--text-accent);
      box-shadow: 0 0 0 3px rgba(100, 181, 246, 0.1);
    }

    .form-textarea {
      resize: vertical;
      min-height: 100px;
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      
      .content-section {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
      }
      
      .sidebar.open {
        transform: translateX(0);
      }
      
      .main-content {
        margin-left: 0;
      }
      
      .messaging-panel {
        width: 100%;
        right: -100%;
      }
      
      .quick-stats {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    /* Loading States */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid var(--glass-border);
      border-radius: 50%;
      border-top-color: var(--text-accent);
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Success/Error Messages */
    .alert {
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .alert-success {
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.3);
      color: #86efac;
    }

    .alert-error {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #fca5a5;
    }

    .alert-warning {
      background: rgba(245, 158, 11, 0.1);
      border: 1px solid rgba(245, 158, 11, 0.3);
      color: #fbbf24;
    }

    .alert-info {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.3);
      color: #93c5fd;
    }

    /* Enhanced Section Styles */
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding: 1.5rem 0;
      border-bottom: 1px solid var(--glass-border);
    }

    .section-header h2 {
      font-size: 2rem;
      font-weight: 700;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 0;
    }

    /* Stream Management Styles */
    .stream-management-grid {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .stream-control-panel,
    .viewer-management,
    .stream-chat {
      background: var(--card-gradient);
      border-radius: var(--border-radius);
      padding: 2rem;
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-primary);
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--glass-border);
    }

    .panel-header h3 {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
    }

    .stream-preview-large {
      width: 100%;
      height: 300px;
      background: #000;
      border-radius: 10px;
      margin-bottom: 1.5rem;
      position: relative;
      overflow: hidden;
    }

    .stream-placeholder {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: var(--text-secondary);
      font-size: 1.1rem;
    }

    .stream-placeholder i {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    .stream-controls-extended {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .control-group {
      display: flex;
      gap: 1rem;
    }

    .stream-info-extended {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .info-item {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .info-item label {
      font-weight: 600;
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .stream-key-display {
      display: flex;
      gap: 0.5rem;
    }

    .stream-key-display input {
      flex: 1;
      padding: 0.5rem;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 5px;
      color: var(--text-primary);
      font-family: monospace;
    }

    /* Students Management Styles */
    .students-management-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 2rem;
    }

    .student-list-panel,
    .student-details-panel,
    .student-activity-panel {
      background: var(--card-gradient);
      border-radius: var(--border-radius);
      padding: 2rem;
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-primary);
    }

    .search-box {
      position: relative;
      width: 200px;
    }

    .search-box input {
      width: 100%;
      padding: 0.5rem 2rem 0.5rem 0.75rem;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 10px;
      color: var(--text-primary);
      outline: none;
    }

    .search-box i {
      position: absolute;
      right: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
    }

    .student-filters {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .filter-btn {
      padding: 0.5rem 1rem;
      background: transparent;
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: var(--transition);
      font-size: 0.9rem;
    }

    .filter-btn.active,
    .filter-btn:hover {
      background: var(--primary-gradient);
      color: white;
      border-color: transparent;
    }

    .student-list-detailed {
      max-height: 500px;
      overflow-y: auto;
    }

    .student-item-detailed {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      margin-bottom: 0.5rem;
      background: var(--glass-bg);
      border-radius: 10px;
      border: 1px solid var(--glass-border);
      cursor: pointer;
      transition: var(--transition);
    }

    .student-item-detailed:hover {
      background: rgba(102, 126, 234, 0.1);
      transform: translateX(5px);
    }

    .student-status {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .status-text {
      font-size: 0.8rem;
      color: var(--text-secondary);
      text-transform: capitalize;
    }

    /* Content Management Styles */
    .content-management-grid {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr;
      gap: 2rem;
    }

    .content-library,
    .content-editor,
    .course-structure {
      background: var(--card-gradient);
      border-radius: var(--border-radius);
      padding: 2rem;
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-primary);
    }

    .content-filters {
      display: flex;
      gap: 1rem;
    }

    .content-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
      max-height: 500px;
      overflow-y: auto;
    }

    .content-item-card {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 10px;
      padding: 1rem;
      cursor: pointer;
      transition: var(--transition);
      text-align: center;
    }

    .content-item-card:hover {
      background: rgba(102, 126, 234, 0.1);
      transform: translateY(-5px);
    }

    .content-icon {
      font-size: 2rem;
      margin-bottom: 1rem;
      color: var(--text-accent);
    }

    .content-info h4 {
      font-size: 1rem;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
    }

    .content-info p {
      font-size: 0.8rem;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
    }

    .content-size {
      font-size: 0.7rem;
      color: var(--text-secondary);
    }

    .content-actions {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    /* Assignments Styles */
    .assignments-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 2rem;
    }

    .assignment-list-panel,
    .assignment-details-panel,
    .submission-overview {
      background: var(--card-gradient);
      border-radius: var(--border-radius);
      padding: 2rem;
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-primary);
    }

    .assignment-filters {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .assignment-list {
      max-height: 500px;
      overflow-y: auto;
    }

    /* Grading Styles */
    .grading-interface {
      display: grid;
      grid-template-columns: 1fr 2fr 1fr;
      gap: 2rem;
    }

    .grading-queue,
    .grading-workspace,
    .gradebook {
      background: var(--card-gradient);
      border-radius: var(--border-radius);
      padding: 2rem;
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-primary);
    }

    .submission-queue {
      max-height: 500px;
      overflow-y: auto;
    }

    .submission-viewer {
      min-height: 400px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 10px;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .viewer-placeholder {
      text-align: center;
      color: var(--text-secondary);
    }

    .viewer-placeholder i {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    /* Analytics Styles */
    .analytics-dashboard {
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }

    .metrics-overview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
    }

    .metric-card {
      background: var(--card-gradient);
      border-radius: var(--border-radius);
      padding: 2rem;
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-primary);
      display: flex;
      align-items: center;
      gap: 1rem;
      transition: var(--transition);
    }

    .metric-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-hover);
    }

    .metric-icon {
      font-size: 2.5rem;
      color: var(--text-accent);
    }

    .metric-data h3 {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
    }

    .metric-data p {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .analytics-charts {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 2rem;
    }

    .chart-container {
      background: var(--card-gradient);
      border-radius: var(--border-radius);
      padding: 2rem;
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-primary);
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .chart-header h3 {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
    }

    /* Schedule Styles */
    .schedule-interface {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr;
      gap: 2rem;
    }

    .calendar-container,
    .event-details,
    .upcoming-events {
      background: var(--card-gradient);
      border-radius: var(--border-radius);
      padding: 2rem;
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-primary);
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .calendar-controls {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    #scheduleCalendar {
      background: var(--glass-bg);
      border-radius: 10px;
      padding: 1rem;
    }

    /* Settings Styles */
    .settings-interface {
      display: grid;
      grid-template-columns: 250px 1fr;
      gap: 2rem;
    }

    .settings-nav {
      background: var(--card-gradient);
      border-radius: var(--border-radius);
      padding: 1rem;
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-primary);
    }

    .settings-menu {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .settings-item {
      padding: 1rem;
      margin-bottom: 0.5rem;
      border-radius: 10px;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--text-secondary);
    }

    .settings-item:hover,
    .settings-item.active {
      background: var(--primary-gradient);
      color: white;
    }

    .settings-content {
      background: var(--card-gradient);
      border-radius: var(--border-radius);
      padding: 2rem;
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-primary);
    }

    .settings-panel {
      display: none;
    }

    .settings-panel.active {
      display: block;
    }

    .setting-group {
      margin-bottom: 2rem;
    }

    .setting-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .setting-toggle {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .setting-toggle input[type="checkbox"] {
      width: 20px;
      height: 20px;
    }

    /* Notification System */
    .notification-container {
      position: fixed;
      top: 2rem;
      right: 2rem;
      z-index: 10000;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      max-width: 400px;
    }

    .notification {
      background: var(--card-gradient);
      border-radius: var(--border-radius);
      padding: 1rem;
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-primary);
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      animation: slideInRight 0.3s ease-out;
    }

    .notification-info {
      border-left: 4px solid #3b82f6;
    }

    .notification-success {
      border-left: 4px solid #10b981;
    }

    .notification-warning {
      border-left: 4px solid #f59e0b;
    }

    .notification-error {
      border-left: 4px solid #ef4444;
    }

    .notification-content {
      flex: 1;
    }

    .notification-title {
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.25rem;
    }

    .notification-message {
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    .notification-close {
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 1.2rem;
      padding: 0;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .notification-close:hover {
      color: var(--text-primary);
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      backdrop-filter: blur(10px);
    }

    .modal-content {
      background: var(--card-gradient);
      border-radius: var(--border-radius);
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-hover);
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem;
      border-bottom: 1px solid var(--glass-border);
    }

    .modal-header h3 {
      margin: 0;
      color: var(--text-primary);
      font-size: 1.3rem;
    }

    .modal-close {
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 1.5rem;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: var(--transition);
    }

    .modal-close:hover {
      background: var(--glass-bg);
      color: var(--text-primary);
    }

    .modal-body {
      padding: 1.5rem;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
      padding: 1.5rem;
      border-top: 1px solid var(--glass-border);
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 0.75rem;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 0.9rem;
      transition: var(--transition);
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      outline: none;
      border-color: var(--text-accent);
      box-shadow: 0 0 0 2px rgba(100, 181, 246, 0.2);
    }

    .form-textarea {
      min-height: 100px;
      resize: vertical;
    }

    .poll-option {
      margin-bottom: 0.5rem;
    }

    .student-selection,
    .submission-selection {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      padding: 1rem;
    }

    .student-checkbox,
    .submission-checkbox {
      margin-right: 0.5rem;
    }

    .checkbox-item {
      display: flex;
      align-items: center;
      padding: 0.5rem;
      margin-bottom: 0.5rem;
      border-radius: 5px;
      transition: var(--transition);
    }

    .checkbox-item:hover {
      background: var(--glass-bg);
    }

    .checkbox-item label {
      margin: 0;
      cursor: pointer;
      flex: 1;
    }

    /* Activity Timeline */
    .activity-timeline {
      max-height: 400px;
      overflow-y: auto;
    }

    .activity-item {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      padding: 1rem;
      margin-bottom: 0.5rem;
      background: var(--glass-bg);
      border-radius: 10px;
      border: 1px solid var(--glass-border);
    }

    .activity-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--accent-gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 0.9rem;
      flex-shrink: 0;
    }

    .activity-content {
      flex: 1;
    }

    .activity-text {
      color: var(--text-primary);
      margin-bottom: 0.25rem;
    }

    .activity-time {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    /* Chat Messages */
    .chat-messages {
      max-height: 300px;
      overflow-y: auto;
      padding: 1rem;
      background: var(--glass-bg);
      border-radius: 10px;
      margin-bottom: 1rem;
    }

    .chat-message {
      margin-bottom: 1rem;
      padding: 0.75rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
    }

    .message-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .sender-name {
      font-weight: 600;
      color: var(--text-accent);
    }

    .message-time {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    .message-content {
      color: var(--text-primary);
      line-height: 1.4;
    }

    .chat-input {
      display: flex;
      gap: 0.5rem;
    }

    .chat-input input {
      flex: 1;
      padding: 0.75rem;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      color: var(--text-primary);
    }

    /* Responsive adjustments */
    @media (max-width: 1400px) {
      .stream-management-grid,
      .students-management-grid,
      .content-management-grid,
      .assignments-grid,
      .grading-interface,
      .schedule-interface {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .section-header {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
      }
      
      .analytics-charts {
        grid-template-columns: 1fr;
      }
      
      .metrics-overview {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .notification-container {
        top: 1rem;
        right: 1rem;
        left: 1rem;
        max-width: none;
      }
      
      .modal-content {
        width: 95%;
        margin: 1rem;
      }
    }

    /* Analytics Styles */
    .analytics-overview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .analytics-card {
      background: var(--card-gradient);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      border: 1px solid var(--glass-border);
      display: flex;
      align-items: center;
      gap: 1rem;
      transition: var(--transition);
    }

    .analytics-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-hover);
    }

    .analytics-card .card-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--accent-gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: white;
    }

    .analytics-card .card-content h3 {
      font-size: 2rem;
      font-weight: 700;
      margin: 0;
      color: var(--text-primary);
    }

    .analytics-card .card-content p {
      margin: 0.5rem 0;
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .trend {
      font-size: 0.8rem;
      font-weight: 600;
      padding: 0.25rem 0.5rem;
      border-radius: 12px;
    }

    .trend.positive {
      background: rgba(34, 197, 94, 0.2);
      color: #22c55e;
    }

    .trend.negative {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
    }

    .analytics-charts {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .chart-container {
      background: var(--card-gradient);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      border: 1px solid var(--glass-border);
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .chart-header h3 {
      margin: 0;
      color: var(--text-primary);
    }

    .performance-table-container {
      background: var(--card-gradient);
      border-radius: var(--border-radius);
      border: 1px solid var(--glass-border);
      margin-bottom: 2rem;
    }

    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem;
      border-bottom: 1px solid var(--glass-border);
    }

    .table-controls {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .table-wrapper {
      overflow-x: auto;
    }

    .performance-table {
      width: 100%;
      border-collapse: collapse;
    }

    .performance-table th,
    .performance-table td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .performance-table th {
      background: rgba(255, 255, 255, 0.02);
      font-weight: 600;
      color: var(--text-accent);
      cursor: pointer;
      transition: var(--transition);
    }

    .performance-table th:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .performance-table .student-info {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .performance-table .student-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--accent-gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: 600;
      color: white;
    }

    .progress-bar {
      position: relative;
      width: 100px;
      height: 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: var(--accent-gradient);
      border-radius: 10px;
      transition: width 0.3s ease;
    }

    .progress-bar span {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 0.7rem;
      font-weight: 600;
      color: white;
    }

    .risk-badge {
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .risk-badge.low {
      background: rgba(34, 197, 94, 0.2);
      color: #22c55e;
    }

    .risk-badge.medium {
      background: rgba(251, 191, 36, 0.2);
      color: #fbbf24;
    }

    .risk-badge.high {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
    }

    .realtime-activity {
      background: var(--card-gradient);
      border-radius: var(--border-radius);
      border: 1px solid var(--glass-border);
      margin-bottom: 2rem;
    }

    .activity-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem;
      border-bottom: 1px solid var(--glass-border);
    }

    .activity-controls {
      display: flex;
      gap: 0.5rem;
    }

    .activity-feed {
      max-height: 300px;
      overflow-y: auto;
      padding: 1rem;
    }

    .activity-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.75rem;
      border-radius: 8px;
      margin-bottom: 0.5rem;
      background: rgba(255, 255, 255, 0.02);
      transition: var(--transition);
    }

    .activity-item:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    /* Schedule Styles */
    .calendar-container {
      background: var(--card-gradient);
      border-radius: var(--border-radius);
      border: 1px solid var(--glass-border);
      margin-bottom: 2rem;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem;
      border-bottom: 1px solid var(--glass-border);
    }

    .calendar-nav {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .calendar-views {
      display: flex;
      gap: 0.5rem;
    }

    .upcoming-events,
    .todays-schedule {
      background: var(--card-gradient);
      border-radius: var(--border-radius);
      border: 1px solid var(--glass-border);
      padding: 1.5rem;
      margin-bottom: 2rem;
    }

    .upcoming-events h3,
    .todays-schedule h3 {
      margin: 0 0 1rem 0;
      color: var(--text-accent);
    }

    .events-list,
    .schedule-timeline {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .event-item,
    .schedule-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 8px;
      transition: var(--transition);
    }

    .event-item:hover,
    .schedule-item:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .event-info h4,
    .schedule-content h4 {
      margin: 0 0 0.25rem 0;
      color: var(--text-primary);
    }

    .event-info p,
    .schedule-content p {
      margin: 0;
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .event-actions {
      display: flex;
      gap: 0.5rem;
    }

    .schedule-time {
      font-weight: 600;
      color: var(--text-accent);
      min-width: 80px;
    }

    .event-type {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      background: var(--accent-gradient);
      color: white;
      border-radius: 12px;
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    /* Modal Enhancements */
    .modal-content.large {
      max-width: 800px;
      width: 90%;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .question-item {
      background: rgba(255, 255, 255, 0.02);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      border: 1px solid var(--glass-border);
    }

    .question-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .question-header h4 {
      margin: 0;
      color: var(--text-accent);
    }

    .options-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .option-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.5rem;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 4px;
    }

    .option-item input[type="text"] {
      flex: 1;
    }

    /* Additional responsive adjustments */
    @media (max-width: 768px) {
      .analytics-overview {
        grid-template-columns: 1fr;
      }
      
      .analytics-charts {
        grid-template-columns: 1fr;
      }
      
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .table-controls {
        flex-direction: column;
        gap: 0.5rem;
      }
      
      .calendar-header {
        flex-direction: column;
        gap: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
      <img src="logo.png" alt="SMX KITS" class="logo" onerror="this.style.display='none'">
      
      <ul class="nav-menu">
        <li class="nav-item active" data-section="overview">
          <i class="fas fa-tachometer-alt"></i>
          <span>Overview</span>
        </li>
        <li class="nav-item" data-section="stream">
          <i class="fas fa-video"></i>
          <span>Live Stream</span>
        </li>
        <li class="nav-item" data-section="students">
          <i class="fas fa-users"></i>
          <span>Students</span>
        </li>
        <li class="nav-item" data-section="content">
          <i class="fas fa-book"></i>
          <span>Content</span>
        </li>
        <li class="nav-item" data-section="assignments">
          <i class="fas fa-tasks"></i>
          <span>Assignments</span>
        </li>
        <li class="nav-item" data-section="grading">
          <i class="fas fa-graduation-cap"></i>
          <span>Grading</span>
        </li>
        <li class="nav-item" data-section="analytics">
          <i class="fas fa-chart-bar"></i>
          <span>Analytics</span>
        </li>
        <li class="nav-item" data-section="schedule">
          <i class="fas fa-calendar"></i>
          <span>Schedule</span>
        </li>
        <li class="nav-item" data-section="settings">
          <i class="fas fa-cog"></i>
          <span>Settings</span>
        </li>
      </ul>

      <div class="user-info">
        <div class="user-avatar" id="userAvatar">I</div>
        <div class="user-details">
          <h4 id="userName">Instructor</h4>
          <span id="userRole">Loading...</span>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Header -->
      <header class="dashboard-header">
        <div class="header-left">
          <h1 id="dashboardTitle">Command Center</h1>
          <p class="header-subtitle" id="dashboardSubtitle">Real-time class monitoring and control</p>
        </div>
        <div class="header-actions">
          <button class="btn btn-primary" id="messageToggle">
            <i class="fas fa-comments"></i>
            <span>Messages</span>
            <span class="notification-badge" id="messageBadge" style="display: none;">0</span>
          </button>
          <button class="btn btn-primary" id="notificationToggle">
            <i class="fas fa-bell"></i>
            <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
          </button>
        </div>
      </header>

      <!-- Class Tabs (Admin Only) -->
      <div class="class-tabs" id="classTabs">
        <div class="tab-list" id="tabList">
          <!-- Tabs will be populated dynamically -->
        </div>
      </div>

      <!-- Dashboard Content -->
      <div id="dashboardContent">
        <!-- Overview Section -->
        <section id="overview-section" class="dashboard-section active">
          <!-- Quick Stats -->
          <div class="quick-stats">
            <div class="stat-card">
              <div class="stat-value" id="totalStudents">0</div>
              <div class="stat-label">Total Students</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="activeStudents">0</div>
              <div class="stat-label">Online Now</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="pendingSubmissions">0</div>
              <div class="stat-label">Pending Grades</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="avgProgress">0%</div>
              <div class="stat-label">Avg Progress</div>
            </div>
          </div>

          <!-- Main Dashboard Grid -->
          <div class="dashboard-grid">
            <!-- Live Stream Control -->
            <div class="stream-control">
              <div class="stream-header">
                <h3 class="stream-title">Live Stream Control</h3>
                <span class="stream-status offline" id="streamStatus">Offline</span>
              </div>
              <div class="stream-preview" id="streamPreview">
                <i class="fas fa-video-slash" style="font-size: 3rem; opacity: 0.5;"></i>
                <span style="margin-left: 1rem;">Stream Offline</span>
              </div>
              <div class="stream-controls">
                <button class="btn btn-success" id="startStreamBtn">
                  <i class="fas fa-play"></i>
                  Start Stream
                </button>
                <button class="btn btn-danger" id="stopStreamBtn" style="display: none;">
                  <i class="fas fa-stop"></i>
                  Stop Stream
                </button>
                <button class="btn btn-primary" id="shareScreenBtn">
                  <i class="fas fa-desktop"></i>
                  Share Screen
                </button>
              </div>
              <div class="stream-info">
                <p><strong>Stream Key:</strong> <span id="streamKey">Not generated</span></p>
                <p><strong>Viewers:</strong> <span id="viewerCount">0</span></p>
              </div>
            </div>

            <!-- Student Activity Panel -->
            <div class="activity-panel">
              <h3 class="panel-title">Student Activity</h3>
              <div class="student-list" id="studentList">
                <!-- Students will be populated dynamically -->
              </div>
            </div>
          </div>

          <!-- Content Management -->
          <div class="content-section">
            <div class="content-card">
              <div class="content-header">
                <h3 class="content-title">Recent Assignments</h3>
                <button class="btn btn-primary" onclick="openModal('assignmentModal')">
                  <i class="fas fa-plus"></i>
                  New Assignment
                </button>
              </div>
              <div class="content-list" id="assignmentList">
                <!-- Assignments will be populated dynamically -->
              </div>
            </div>

            <div class="content-card">
              <div class="content-header">
                <h3 class="content-title">Course Materials</h3>
                <button class="btn btn-primary" onclick="openModal('materialModal')">
                  <i class="fas fa-upload"></i>
                  Upload Material
                </button>
              </div>
              <div class="content-list" id="materialList">
                <!-- Materials will be populated dynamically -->
              </div>
            </div>
          </div>
        </section>

        <!-- Other sections will be added here -->
        <section id="stream-section" class="dashboard-section" style="display: none;">
          <h2>Live Stream Management</h2>
          <!-- Stream management content -->
        </section>

        <section id="students-section" class="dashboard-section" style="display: none;">
          <h2>Student Management</h2>
          <!-- Student management content -->
        </section>

        <section id="content-section" class="dashboard-section" style="display: none;">
          <h2>Content Management</h2>
          <!-- Content management content -->
        </section>

        <section id="assignments-section" class="dashboard-section" style="display: none;">
          <h2>Assignment Management</h2>
          <!-- Assignment management content -->
        </section>

        <section id="grading-section" class="dashboard-section" style="display: none;">
          <h2>Grading Center</h2>
          <!-- Grading content -->
        </section>

        <section id="analytics-section" class="dashboard-section" style="display: none;">
          <div class="section-header">
            <h2>Analytics & Reports</h2>
            <div class="section-actions">
              <button class="btn btn-secondary" onclick="exportAnalytics()">
                <i class="fas fa-download"></i>
                Export Data
              </button>
              <button class="btn btn-primary" onclick="generateReport()">
                <i class="fas fa-chart-line"></i>
                Generate Report
              </button>
            </div>
          </div>

          <!-- Analytics Overview Cards -->
          <div class="analytics-overview">
            <div class="analytics-card">
              <div class="card-icon">
                <i class="fas fa-users"></i>
              </div>
              <div class="card-content">
                <h3 id="totalStudentsAnalytics">0</h3>
                <p>Total Students</p>
                <span class="trend positive" id="studentsTrend">+0%</span>
              </div>
            </div>
            
            <div class="analytics-card">
              <div class="card-icon">
                <i class="fas fa-user-check"></i>
              </div>
              <div class="card-content">
                <h3 id="activeStudentsAnalytics">0</h3>
                <p>Active Students</p>
                <span class="trend positive" id="activeTrend">+0%</span>
              </div>
            </div>
            
            <div class="analytics-card">
              <div class="card-icon">
                <i class="fas fa-chart-line"></i>
              </div>
              <div class="card-content">
                <h3 id="engagementRate">0%</h3>
                <p>Engagement Rate</p>
                <span class="trend positive" id="engagementTrend">+0%</span>
              </div>
            </div>
            
            <div class="analytics-card">
              <div class="card-icon">
                <i class="fas fa-graduation-cap"></i>
              </div>
              <div class="card-content">
                <h3 id="averageGradeAnalytics">0%</h3>
                <p>Average Grade</p>
                <span class="trend positive" id="gradeTrend">+0%</span>
              </div>
            </div>
          </div>

          <!-- Analytics Charts -->
          <div class="analytics-charts">
            <div class="chart-container">
              <div class="chart-header">
                <h3>Student Engagement Trends</h3>
                <select id="engagementPeriod" onchange="updateEngagementChart()">
                  <option value="7">Last 7 Days</option>
                  <option value="30" selected>Last 30 Days</option>
                  <option value="90">Last 90 Days</option>
                </select>
              </div>
              <canvas id="engagementChart"></canvas>
            </div>
            
            <div class="chart-container">
              <div class="chart-header">
                <h3>Activity Patterns</h3>
                <select id="activityType" onchange="updateActivityChart()">
                  <option value="all">All Activities</option>
                  <option value="login">Logins</option>
                  <option value="assignment-submit">Assignments</option>
                  <option value="quiz-complete">Quizzes</option>
                </select>
              </div>
              <canvas id="activityChart"></canvas>
            </div>
          </div>

          <!-- Student Performance Table -->
          <div class="performance-table-container">
            <div class="table-header">
              <h3>Student Performance Overview</h3>
              <div class="table-controls">
                <input type="text" placeholder="Search students..." id="studentSearch" onkeyup="filterStudents()">
                <select id="riskFilter" onchange="filterStudents()">
                  <option value="all">All Students</option>
                  <option value="high">High Risk</option>
                  <option value="medium">Medium Risk</option>
                  <option value="low">Low Risk</option>
                </select>
              </div>
            </div>
            <div class="table-wrapper">
              <table class="performance-table" id="performanceTable">
                <thead>
                  <tr>
                    <th onclick="sortTable('name')">Student <i class="fas fa-sort"></i></th>
                    <th onclick="sortTable('grade')">Avg Grade <i class="fas fa-sort"></i></th>
                    <th onclick="sortTable('participation')">Participation <i class="fas fa-sort"></i></th>
                    <th onclick="sortTable('lastActive')">Last Active <i class="fas fa-sort"></i></th>
                    <th onclick="sortTable('risk')">Risk Level <i class="fas fa-sort"></i></th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="performanceTableBody">
                  <!-- Student data will be populated here -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- Real-time Activity Feed -->
          <div class="realtime-activity">
            <div class="activity-header">
              <h3>Real-time Activity</h3>
              <div class="activity-controls">
                <button class="btn btn-sm" onclick="toggleActivityFeed()" id="activityToggle">
                  <i class="fas fa-pause"></i>
                  Pause
                </button>
                <button class="btn btn-sm" onclick="clearActivityFeed()">
                  <i class="fas fa-trash"></i>
                  Clear
                </button>
              </div>
            </div>
            <div class="activity-feed" id="activityFeed">
              <!-- Real-time activities will appear here -->
            </div>
          </div>
        </section>

        <section id="schedule-section" class="dashboard-section" style="display: none;">
          <div class="section-header">
            <h2>Schedule Management</h2>
            <div class="section-actions">
              <button class="btn btn-primary" onclick="openModal('eventModal')">
                <i class="fas fa-plus"></i>
                New Event
              </button>
              <button class="btn btn-secondary" onclick="syncCalendar()">
                <i class="fas fa-sync"></i>
                Sync Calendar
              </button>
            </div>
          </div>

          <!-- Calendar View -->
          <div class="calendar-container">
            <div class="calendar-header">
              <div class="calendar-nav">
                <button class="btn btn-sm" onclick="previousMonth()">
                  <i class="fas fa-chevron-left"></i>
                </button>
                <h3 id="calendarTitle">Loading...</h3>
                <button class="btn btn-sm" onclick="nextMonth()">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </div>
              <div class="calendar-views">
                <button class="btn btn-sm active" onclick="setCalendarView('month')">Month</button>
                <button class="btn btn-sm" onclick="setCalendarView('week')">Week</button>
                <button class="btn btn-sm" onclick="setCalendarView('day')">Day</button>
              </div>
            </div>
            <div id="calendar"></div>
          </div>

          <!-- Upcoming Events -->
          <div class="upcoming-events">
            <h3>Upcoming Events</h3>
            <div class="events-list" id="upcomingEventsList">
              <!-- Events will be populated here -->
            </div>
          </div>

          <!-- Today's Schedule -->
          <div class="todays-schedule">
            <h3>Today's Schedule</h3>
            <div class="schedule-timeline" id="todaysSchedule">
              <!-- Today's events will be populated here -->
            </div>
          </div>
        </section>

        <section id="settings-section" class="dashboard-section" style="display: none;">
          <h2>Settings</h2>
          <!-- Settings content -->
        </section>
      </div>
    </main>

    <!-- Messaging Panel -->
    <div class="messaging-panel" id="messagingPanel">
      <div class="messaging-header">
        <h3>Messages</h3>
        <button class="modal-close" onclick="toggleMessaging()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="messaging-content" id="messagingContent">
        <!-- Messages will be populated dynamically -->
      </div>
      <div class="message-input">
        <input type="text" placeholder="Type a message..." id="messageInput">
        <button class="btn btn-primary" onclick="sendMessage()">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Modals -->
  <!-- Assignment Modal -->
  <div class="modal-overlay" id="assignmentModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Create New Assignment</h3>
        <button class="modal-close" onclick="closeModal('assignmentModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <form id="assignmentForm">
        <div class="form-group">
          <label class="form-label">Assignment Title</label>
          <input type="text" class="form-input" name="title" required>
        </div>
        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea class="form-textarea" name="description" required></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Due Date</label>
          <input type="datetime-local" class="form-input" name="dueDate" required>
        </div>
        <div class="form-group">
          <label class="form-label">Points</label>
          <input type="number" class="form-input" name="points" min="0" max="100" required>
        </div>
        <div class="form-group">
          <button type="submit" class="btn btn-primary">Create Assignment</button>
          <button type="button" class="btn btn-secondary" onclick="closeModal('assignmentModal')">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Material Modal -->
  <div class="modal-overlay" id="materialModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Upload Course Material</h3>
        <button class="modal-close" onclick="closeModal('materialModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <form id="materialForm">
        <div class="form-group">
          <label class="form-label">Material Title</label>
          <input type="text" class="form-input" name="title" required>
        </div>
        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea class="form-textarea" name="description"></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">File</label>
          <input type="file" class="form-input" name="file" required>
        </div>
        <div class="form-group">
          <label class="form-label">Category</label>
          <select class="form-select" name="category" required>
            <option value="">Select Category</option>
            <option value="lecture">Lecture</option>
            <option value="assignment">Assignment</option>
            <option value="resource">Resource</option>
            <option value="reference">Reference</option>
          </select>
        </div>
        <div class="form-group">
          <button type="submit" class="btn btn-primary">Upload Material</button>
          <button type="button" class="btn btn-secondary" onclick="closeModal('materialModal')">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Event Modal -->
  <div class="modal-overlay" id="eventModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Create New Event</h3>
        <button class="modal-close" onclick="closeModal('eventModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <form id="eventForm">
        <div class="form-group">
          <label class="form-label">Event Title</label>
          <input type="text" class="form-input" name="title" required>
        </div>
        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea class="form-textarea" name="description"></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Event Type</label>
          <select class="form-select" name="type" required>
            <option value="">Select Type</option>
            <option value="class">Class Session</option>
            <option value="assignment">Assignment Due</option>
            <option value="exam">Exam</option>
            <option value="meeting">Meeting</option>
            <option value="deadline">Deadline</option>
            <option value="announcement">Announcement</option>
          </select>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Start Date & Time</label>
            <input type="datetime-local" class="form-input" name="startDate" required>
          </div>
          <div class="form-group">
            <label class="form-label">End Date & Time</label>
            <input type="datetime-local" class="form-input" name="endDate" required>
          </div>
        </div>
        <div class="form-group">
          <label class="form-checkbox">
            <input type="checkbox" name="allDay">
            <span class="checkmark"></span>
            All Day Event
          </label>
        </div>
        <div class="form-group">
          <label class="form-label">Location</label>
          <input type="text" class="form-input" name="location" placeholder="Physical location or meeting room">
        </div>
        <div class="form-group">
          <label class="form-label">Virtual Meeting Link</label>
          <input type="url" class="form-input" name="virtualMeetingUrl" placeholder="Zoom, Teams, or other meeting link">
        </div>
        <div class="form-group">
          <label class="form-label">Priority</label>
          <select class="form-select" name="priority">
            <option value="low">Low</option>
            <option value="medium" selected>Medium</option>
            <option value="high">High</option>
            <option value="urgent">Urgent</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Visibility</label>
          <select class="form-select" name="visibility">
            <option value="class-only" selected>Class Only</option>
            <option value="public">Public</option>
            <option value="private">Private</option>
          </select>
        </div>
        <div class="form-group">
          <button type="submit" class="btn btn-primary">Create Event</button>
          <button type="button" class="btn btn-secondary" onclick="closeModal('eventModal')">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Interactive Exercise Modal -->
  <div class="modal-overlay" id="exerciseModal">
    <div class="modal-content large">
      <div class="modal-header">
        <h3 class="modal-title">Create Interactive Exercise</h3>
        <button class="modal-close" onclick="closeModal('exerciseModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <form id="exerciseForm">
        <div class="form-group">
          <label class="form-label">Exercise Title</label>
          <input type="text" class="form-input" name="title" required>
        </div>
        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea class="form-textarea" name="description"></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Exercise Type</label>
            <select class="form-select" name="type" required>
              <option value="">Select Type</option>
              <option value="quiz">Quiz</option>
              <option value="poll">Poll</option>
              <option value="survey">Survey</option>
              <option value="game">Game</option>
              <option value="assessment">Assessment</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Time Limit (minutes)</label>
            <input type="number" class="form-input" name="timeLimit" min="0" placeholder="0 = No limit">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Questions</label>
          <div id="questionsContainer">
            <!-- Questions will be added dynamically -->
          </div>
          <button type="button" class="btn btn-secondary" onclick="addQuestion()">
            <i class="fas fa-plus"></i>
            Add Question
          </button>
        </div>
        <div class="form-group">
          <button type="submit" class="btn btn-primary">Create Exercise</button>
          <button type="button" class="btn btn-secondary" onclick="closeModal('exerciseModal')">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Whiteboard Modal -->
  <div class="modal-overlay" id="whiteboardModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Create Whiteboard Session</h3>
        <button class="modal-close" onclick="closeModal('whiteboardModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <form id="whiteboardForm">
        <div class="form-group">
          <label class="form-label">Session Title</label>
          <input type="text" class="form-input" name="title" required>
        </div>
        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea class="form-textarea" name="description"></textarea>
        </div>
        <div class="form-group">
          <label class="form-checkbox">
            <input type="checkbox" name="allowStudentEdit">
            <span class="checkmark"></span>
            Allow students to edit
          </label>
        </div>
        <div class="form-group">
          <label class="form-checkbox">
            <input type="checkbox" name="moderatedMode">
            <span class="checkmark"></span>
            Moderated mode (approve changes)
          </label>
        </div>
        <div class="form-group">
          <button type="submit" class="btn btn-primary">Create Whiteboard</button>
          <button type="button" class="btn btn-secondary" onclick="closeModal('whiteboardModal')">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Global variables
    let socket;
    let currentUser = null;
    let currentClass = null;
    let userClasses = [];
    let isAdmin = false;
    let dashboardSections;

    // Initialize dashboard
    document.addEventListener('DOMContentLoaded', function() {
      initializeDashboard();
    });

    async function initializeDashboard() {
      try {
        // Check authentication
        const response = await fetch('/api/auth/me');
        if (!response.ok) {
          window.location.href = '/login.html';
          return;
        }

        currentUser = await response.json();
        isAdmin = currentUser.role === 'admin';
        
        // Update user info
        updateUserInfo();
        
        // Load user's classes
        await loadUserClasses();
        
        // Initialize socket connection
        initializeSocket();
        
        // Load dashboard data
        await loadDashboardData();
        
        // Set up event listeners
        setupEventListeners();
        
        // Initialize dashboard sections
        dashboardSections = new InstructorDashboardSections(window);
        dashboardSections.init();
        
        // Initialize enhanced features
        if (window.instructorDashboardEnhanced) {
          window.instructorDashboardEnhanced.setCurrentUser(currentUser);
          window.instructorDashboardEnhanced.setCurrentClass(currentClass);
        }
        
        console.log('✅ Dashboard initialized successfully');
      } catch (error) {
        console.error('❌ Failed to initialize dashboard:', error);
        showAlert('Failed to initialize dashboard', 'error');
      }
    }

    function updateUserInfo() {
      document.getElementById('userName').textContent = currentUser.name;
      document.getElementById('userRole').textContent = currentUser.role.charAt(0).toUpperCase() + currentUser.role.slice(1);
      document.getElementById('userAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
    }

    async function loadUserClasses() {
      try {
        const response = await fetch('/api/classes/my-classes');
        if (!response.ok) throw new Error('Failed to load classes');
        
        userClasses = await response.json();
        
        if (isAdmin && userClasses.length > 1) {
          // Show class tabs for admin
          setupClassTabs();
        } else if (userClasses.length > 0) {
          // Set current class for instructor
          currentClass = userClasses[0];
          updateDashboardTitle();
        }
      } catch (error) {
        console.error('❌ Failed to load classes:', error);
        showAlert('Failed to load classes', 'error');
      }
    }

    function setupClassTabs() {
      const classTabs = document.getElementById('classTabs');
      const tabList = document.getElementById('tabList');
      
      classTabs.classList.add('show');
      tabList.innerHTML = '';
      
      userClasses.forEach((cls, index) => {
        const tab = document.createElement('button');
        tab.className = `tab-button ${index === 0 ? 'active' : ''}`;
        tab.textContent = cls.name;
        tab.onclick = () => switchClass(cls, tab);
        tabList.appendChild(tab);
      });
      
      // Set first class as current
      if (userClasses.length > 0) {
        currentClass = userClasses[0];
        updateDashboardTitle();
      }
    }

    function switchClass(cls, tabElement) {
      // Update active tab
      document.querySelectorAll('.tab-button').forEach(tab => tab.classList.remove('active'));
      tabElement.classList.add('active');
      
      // Update current class
      currentClass = cls;
      updateDashboardTitle();
      
      // Reload dashboard data for new class
      loadDashboardData();
    }

    function updateDashboardTitle() {
      if (currentClass) {
        document.getElementById('dashboardTitle').textContent = currentClass.name;
        document.getElementById('dashboardSubtitle').textContent = `${currentClass.students?.length || 0} students • ${currentClass.streamStatus || 'offline'}`;
      }
    }

    function initializeSocket() {
      socket = io();
      
      socket.on('connect', () => {
        console.log('✅ Connected to server');
        if (currentUser) {
          socket.emit('join-instructor', { 
            userId: currentUser._id, 
            classId: currentClass?._id 
          });
        }
      });

      socket.on('disconnect', () => {
        console.log('❌ Disconnected from server');
      });

      // Real-time updates
      socket.on('student-activity', (data) => {
        updateStudentActivity(data);
      });

      socket.on('new-submission', (data) => {
        updateSubmissionCount();
        showNotification('New submission received', 'info');
      });

      socket.on('new-message', (data) => {
        updateMessageCount();
        addMessageToPanel(data);
      });

      socket.on('stream-update', (data) => {
        updateStreamStatus(data);
      });
    }

    async function loadDashboardData() {
      if (!currentClass) return;
      
      try {
        // Load students
        await loadStudents();
        
        // Load assignments
        await loadAssignments();
        
        // Load materials
        await loadMaterials();
        
        // Load statistics
        await loadStatistics();
        
        // Load stream status
        await loadStreamStatus();
        
        // Load analytics
        await loadAnalytics();
        
        // Load schedule
        await loadSchedule();
        
      } catch (error) {
        console.error('❌ Failed to load dashboard data:', error);
        showAlert('Failed to load dashboard data', 'error');
      }
    }

    async function loadStudents() {
      try {
        const response = await fetch(`/api/classes/${currentClass._id}/students`);
        if (!response.ok) throw new Error('Failed to load students');
        
        const students = await response.json();
        updateStudentList(students);
        
        // Update total students stat
        document.getElementById('totalStudents').textContent = students.length;
        
      } catch (error) {
        console.error('❌ Failed to load students:', error);
      }
    }

    function updateStudentList(students) {
      const studentList = document.getElementById('studentList');
      studentList.innerHTML = '';
      
      students.forEach(student => {
        const studentItem = document.createElement('div');
        studentItem.className = 'student-item';
        studentItem.innerHTML = `
          <div class="student-info">
            <div class="student-avatar">${student.name.charAt(0).toUpperCase()}</div>
            <div class="student-details">
              <h4>${student.name}</h4>
              <span>Last active: ${formatTime(student.lastActive || new Date())}</span>
            </div>
          </div>
          <div class="activity-indicator ${student.status || 'offline'}"></div>
        `;
        studentList.appendChild(studentItem);
      });
    }

    async function loadAssignments() {
      try {
        const response = await fetch(`/api/assignments/class/${currentClass._id}`);
        if (!response.ok) throw new Error('Failed to load assignments');
        
        const assignments = await response.json();
        updateAssignmentList(assignments);
        
      } catch (error) {
        console.error('❌ Failed to load assignments:', error);
      }
    }

    function updateAssignmentList(assignments) {
      const assignmentList = document.getElementById('assignmentList');
      assignmentList.innerHTML = '';
      
      assignments.slice(0, 5).forEach(assignment => {
        const assignmentItem = document.createElement('div');
        assignmentItem.className = 'content-item';
        assignmentItem.innerHTML = `
          <div>
            <h4>${assignment.title}</h4>
            <span>Due: ${formatDate(assignment.dueDate)}</span>
          </div>
          <div>
            <span>${assignment.submissions?.length || 0} submissions</span>
          </div>
        `;
        assignmentList.appendChild(assignmentItem);
      });
    }

    async function loadMaterials() {
      try {
        const response = await fetch(`/api/materials/class/${currentClass._id}`);
        if (!response.ok) throw new Error('Failed to load materials');
        
        const materials = await response.json();
        updateMaterialList(materials);
        
      } catch (error) {
        console.error('❌ Failed to load materials:', error);
      }
    }

    function updateMaterialList(materials) {
      const materialList = document.getElementById('materialList');
      materialList.innerHTML = '';
      
      materials.slice(0, 5).forEach(material => {
        const materialItem = document.createElement('div');
        materialItem.className = 'content-item';
        materialItem.innerHTML = `
          <div>
            <h4>${material.title}</h4>
            <span>${material.category}</span>
          </div>
          <div>
            <i class="fas fa-download" style="cursor: pointer;" onclick="downloadMaterial('${material._id}')"></i>
          </div>
        `;
        materialList.appendChild(materialItem);
      });
    }

    async function loadStatistics() {
      try {
        const response = await fetch(`/api/analytics/class/${currentClass._id}/stats`);
        if (!response.ok) throw new Error('Failed to load statistics');
        
        const stats = await response.json();
        updateStatistics(stats);
        
      } catch (error) {
        console.error('❌ Failed to load statistics:', error);
      }
    }

    function updateStatistics(stats) {
      document.getElementById('activeStudents').textContent = stats.activeStudents || 0;
      document.getElementById('pendingSubmissions').textContent = stats.pendingSubmissions || 0;
      document.getElementById('avgProgress').textContent = `${stats.avgProgress || 0}%`;
    }

    async function loadStreamStatus() {
      try {
        const response = await fetch(`/api/streams/class/${currentClass._id}/status`);
        if (!response.ok) throw new Error('Failed to load stream status');
        
        const streamData = await response.json();
        updateStreamStatus(streamData);
        
      } catch (error) {
        console.error('❌ Failed to load stream status:', error);
      }
    }

    function updateStreamStatus(streamData) {
      const statusElement = document.getElementById('streamStatus');
      const streamKey = document.getElementById('streamKey');
      const viewerCount = document.getElementById('viewerCount');
      const startBtn = document.getElementById('startStreamBtn');
      const stopBtn = document.getElementById('stopStreamBtn');
      
      statusElement.textContent = streamData.status || 'Offline';
      statusElement.className = `stream-status ${streamData.status || 'offline'}`;
      
      streamKey.textContent = streamData.streamKey || 'Not generated';
      viewerCount.textContent = streamData.viewerCount || 0;
      
      if (streamData.status === 'live') {
        startBtn.style.display = 'none';
        stopBtn.style.display = 'inline-flex';
      } else {
        startBtn.style.display = 'inline-flex';
        stopBtn.style.display = 'none';
      }
    }

    function setupEventListeners() {
      // Navigation
      document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', () => {
          const section = item.dataset.section;
          switchSection(section);
          
          // Update active nav item
          document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
          item.classList.add('active');
        });
      });

      // Stream controls
      document.getElementById('startStreamBtn').addEventListener('click', startStream);
      document.getElementById('stopStreamBtn').addEventListener('click', stopStream);
      document.getElementById('shareScreenBtn').addEventListener('click', shareScreen);

      // Messaging
      document.getElementById('messageToggle').addEventListener('click', toggleMessaging);
      document.getElementById('messageInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          sendMessage();
        }
      });

      // Forms
      document.getElementById('assignmentForm').addEventListener('submit', createAssignment);
      document.getElementById('materialForm').addEventListener('submit', uploadMaterial);
    }

    function switchSection(sectionName) {
      // Hide all sections
      document.querySelectorAll('.dashboard-section').forEach(section => {
        section.style.display = 'none';
      });
      
      // Show selected section
      const targetSection = document.getElementById(`${sectionName}-section`);
      if (targetSection) {
        targetSection.style.display = 'block';
      }
    }

    async function startStream() {
      try {
        const response = await fetch(`/api/streams/class/${currentClass._id}/start`, {
          method: 'POST'
        });
        
        if (!response.ok) throw new Error('Failed to start stream');
        
        const streamData = await response.json();
        updateStreamStatus(streamData);
        showAlert('Stream started successfully', 'success');
        
      } catch (error) {
        console.error('❌ Failed to start stream:', error);
        showAlert('Failed to start stream', 'error');
      }
    }

    async function stopStream() {
      try {
        const response = await fetch(`/api/streams/class/${currentClass._id}/stop`, {
          method: 'POST'
        });
        
        if (!response.ok) throw new Error('Failed to stop stream');
        
        const streamData = await response.json();
        updateStreamStatus(streamData);
        showAlert('Stream stopped successfully', 'success');
        
      } catch (error) {
        console.error('❌ Failed to stop stream:', error);
        showAlert('Failed to stop stream', 'error');
      }
    }

    function shareScreen() {
      // Implement screen sharing functionality
      showAlert('Screen sharing feature coming soon', 'info');
    }

    function toggleMessaging() {
      const panel = document.getElementById('messagingPanel');
      panel.classList.toggle('open');
    }

    async function sendMessage() {
      const input = document.getElementById('messageInput');
      const message = input.value.trim();
      
      if (!message) return;
      
      try {
        const response = await fetch('/api/messages/send', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            classId: currentClass._id,
            message: message,
            type: 'broadcast'
          })
        });
        
        if (!response.ok) throw new Error('Failed to send message');
        
        input.value = '';
        showAlert('Message sent successfully', 'success');
        
      } catch (error) {
        console.error('❌ Failed to send message:', error);
        showAlert('Failed to send message', 'error');
      }
    }

    async function createAssignment(e) {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const assignmentData = {
        title: formData.get('title'),
        description: formData.get('description'),
        dueDate: formData.get('dueDate'),
        points: parseInt(formData.get('points')),
        classId: currentClass._id
      };
      
      try {
        const response = await fetch('/api/assignments/create', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(assignmentData)
        });
        
        if (!response.ok) throw new Error('Failed to create assignment');
        
        closeModal('assignmentModal');
        loadAssignments();
        showAlert('Assignment created successfully', 'success');
        
      } catch (error) {
        console.error('❌ Failed to create assignment:', error);
        showAlert('Failed to create assignment', 'error');
      }
    }

    async function uploadMaterial(e) {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      formData.append('classId', currentClass._id);
      
      try {
        const response = await fetch('/api/materials/upload', {
          method: 'POST',
          body: formData
        });
        
        if (!response.ok) throw new Error('Failed to upload material');
        
        closeModal('materialModal');
        loadMaterials();
        showAlert('Material uploaded successfully', 'success');
        
      } catch (error) {
        console.error('❌ Failed to upload material:', error);
        showAlert('Failed to upload material', 'error');
      }
    }

    // Utility functions
    function openModal(modalId) {
      const modal = document.getElementById(modalId);
      modal.classList.add('active');
    }

    function closeModal(modalId) {
      const modal = document.getElementById(modalId);
      modal.classList.remove('active');
    }

    function showAlert(message, type = 'info') {
      const alert = document.createElement('div');
      alert.className = `alert alert-${type}`;
      alert.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info'}"></i>
        <span>${message}</span>
      `;
      
      document.body.appendChild(alert);
      
      setTimeout(() => {
        alert.remove();
      }, 5000);
    }

    function formatDate(dateString) {
      return new Date(dateString).toLocaleDateString();
    }

    function formatTime(dateString) {
      return new Date(dateString).toLocaleTimeString();
    }

    function updateStudentActivity(data) {
      // Update student activity in real-time
      const studentItems = document.querySelectorAll('.student-item');
      studentItems.forEach(item => {
        const studentName = item.querySelector('.student-details h4').textContent;
        if (data.studentName === studentName) {
          const indicator = item.querySelector('.activity-indicator');
          indicator.className = `activity-indicator ${data.status}`;
        }
      });
    }

    function updateSubmissionCount() {
      const currentCount = parseInt(document.getElementById('pendingSubmissions').textContent);
      document.getElementById('pendingSubmissions').textContent = currentCount + 1;
    }

    function updateMessageCount() {
      const badge = document.getElementById('messageBadge');
      const currentCount = parseInt(badge.textContent) || 0;
      badge.textContent = currentCount + 1;
      badge.style.display = 'flex';
    }

    function addMessageToPanel(messageData) {
      const messagingContent = document.getElementById('messagingContent');
      const messageElement = document.createElement('div');
      messageElement.className = 'message-item';
      messageElement.innerHTML = `
        <div class="message-sender">${messageData.senderName}</div>
        <div class="message-text">${messageData.message}</div>
        <div class="message-time">${formatTime(messageData.timestamp)}</div>
      `;
      messagingContent.appendChild(messageElement);
      messagingContent.scrollTop = messagingContent.scrollHeight;
    }

    function showNotification(message, type) {
      // Create notification element
      const notification = document.createElement('div');
      notification.className = `alert alert-${type}`;
      notification.style.position = 'fixed';
      notification.style.top = '20px';
      notification.style.right = '20px';
      notification.style.zIndex = '9999';
      notification.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info'}"></i>
        <span>${message}</span>
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 5000);
    }

    async function downloadMaterial(materialId) {
      try {
        const response = await fetch(`/api/materials/${materialId}/download`);
        if (!response.ok) throw new Error('Failed to download material');
        
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'material';
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
        
      } catch (error) {
        console.error('❌ Failed to download material:', error);
        showAlert('Failed to download material', 'error');
      }
    }

    // ===== ANALYTICS FUNCTIONS =====
    
    let analyticsData = {};
    let engagementChart = null;
    let activityChart = null;
    
    async function loadAnalytics() {
      if (!currentClass) return;
      
      try {
        const response = await fetch(`/api/analytics/class/${currentClass._id}/dashboard`);
        if (!response.ok) throw new Error('Failed to load analytics');
        
        analyticsData = await response.json();
        updateAnalyticsDisplay();
        
      } catch (error) {
        console.error('❌ Failed to load analytics:', error);
        showAlert('Failed to load analytics', 'error');
      }
    }
    
    function updateAnalyticsDisplay() {
      const overview = analyticsData.overview || {};
      
      document.getElementById('totalStudentsAnalytics').textContent = overview.totalStudents || 0;
      document.getElementById('activeStudentsAnalytics').textContent = overview.activeStudents || 0;
      document.getElementById('engagementRate').textContent = `${overview.engagementRate || 0}%`;
      document.getElementById('averageGradeAnalytics').textContent = `${Math.round(overview.averageGrade || 0)}%`;
      
      // Update charts
      updateEngagementChart();
      updateActivityChart();
      
      // Update performance table
      updatePerformanceTable();
    }
    
    function updateEngagementChart() {
      const ctx = document.getElementById('engagementChart');
      if (!ctx) return;
      
      if (engagementChart) {
        engagementChart.destroy();
      }
      
      const trends = analyticsData.engagementTrends || [];
      const labels = trends.map(t => new Date(t.date).toLocaleDateString());
      const data = trends.map(t => t.activeStudents);
      
      engagementChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [{
            label: 'Active Students',
            data,
            borderColor: '#3b82f6',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }
    
    function updateActivityChart() {
      const ctx = document.getElementById('activityChart');
      if (!ctx) return;
      
      if (activityChart) {
        activityChart.destroy();
      }
      
      const patterns = analyticsData.currentMetrics?.activityPatterns?.hourlyActivity || [];
      const labels = patterns.map(p => `${p.hour}:00`);
      const data = patterns.map(p => p.count);
      
      activityChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels,
          datasets: [{
            label: 'Activities',
            data,
            backgroundColor: 'rgba(79, 172, 254, 0.8)',
            borderColor: '#4facfe',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }
    
    async function updatePerformanceTable() {
      if (!currentClass) return;
      
      try {
        const response = await fetch(`/api/analytics/class/${currentClass._id}/students`);
        if (!response.ok) throw new Error('Failed to load student performance');
        
        const students = await response.json();
        const tbody = document.getElementById('performanceTableBody');
        tbody.innerHTML = '';
        
        students.forEach(student => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>
              <div class="student-info">
                <div class="student-avatar">${student.name.charAt(0).toUpperCase()}</div>
                <span>${student.name}</span>
              </div>
            </td>
            <td>${student.metrics.averageGrade.toFixed(1)}%</td>
            <td>
              <div class="progress-bar">
                <div class="progress-fill" style="width: ${student.metrics.participationScore}%"></div>
                <span>${student.metrics.participationScore}%</span>
              </div>
            </td>
            <td>${student.metrics.lastActive ? formatTime(student.metrics.lastActive) : 'Never'}</td>
            <td>
              <span class="risk-badge ${student.metrics.riskLevel}">${student.metrics.riskLevel}</span>
            </td>
            <td>
              <button class="btn btn-sm" onclick="viewStudentDetails('${student.studentId}')">
                <i class="fas fa-eye"></i>
              </button>
              <button class="btn btn-sm" onclick="messageStudent('${student.studentId}')">
                <i class="fas fa-message"></i>
              </button>
            </td>
          `;
          tbody.appendChild(row);
        });
        
      } catch (error) {
        console.error('❌ Failed to load student performance:', error);
      }
    }
    
    async function exportAnalytics() {
      if (!currentClass) return;
      
      try {
        const response = await fetch(`/api/analytics/class/${currentClass._id}/export?format=json`);
        if (!response.ok) throw new Error('Failed to export analytics');
        
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `analytics-${currentClass.name}-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
        
        showAlert('Analytics exported successfully', 'success');
      } catch (error) {
        console.error('❌ Failed to export analytics:', error);
        showAlert('Failed to export analytics', 'error');
      }
    }
    
    async function generateReport() {
      if (!currentClass) return;
      
      try {
        const response = await fetch(`/api/analytics/class/${currentClass._id}/generate-report`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ date: new Date() })
        });
        
        if (!response.ok) throw new Error('Failed to generate report');
        
        showAlert('Analytics report generated successfully', 'success');
        loadAnalytics(); // Refresh data
      } catch (error) {
        console.error('❌ Failed to generate report:', error);
        showAlert('Failed to generate report', 'error');
      }
    }
    
    // ===== SCHEDULE FUNCTIONS =====
    
    let calendar = null;
    let currentCalendarView = 'month';
    
    async function loadSchedule() {
      if (!currentClass) return;
      
      try {
        // Load calendar events
        const response = await fetch(`/api/schedule/class/${currentClass._id}/events`);
        if (!response.ok) throw new Error('Failed to load schedule');
        
        const events = await response.json();
        initializeCalendar(events);
        loadUpcomingEvents();
        loadTodaysSchedule();
        
      } catch (error) {
        console.error('❌ Failed to load schedule:', error);
        showAlert('Failed to load schedule', 'error');
      }
    }
    
    function initializeCalendar(events) {
      const calendarEl = document.getElementById('calendar');
      
      if (calendar) {
        calendar.destroy();
      }
      
      calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        headerToolbar: false,
        events: events.map(event => ({
          id: event._id,
          title: event.title,
          start: event.startDate,
          end: event.endDate,
          allDay: event.allDay,
          backgroundColor: event.color || '#3b82f6',
          borderColor: event.color || '#3b82f6'
        })),
        eventClick: function(info) {
          viewEventDetails(info.event.id);
        },
        dateClick: function(info) {
          createEventAtDate(info.date);
        }
      });
      
      calendar.render();
      updateCalendarTitle();
    }
    
    function updateCalendarTitle() {
      if (calendar) {
        document.getElementById('calendarTitle').textContent = calendar.view.title;
      }
    }
    
    function previousMonth() {
      if (calendar) {
        calendar.prev();
        updateCalendarTitle();
      }
    }
    
    function nextMonth() {
      if (calendar) {
        calendar.next();
        updateCalendarTitle();
      }
    }
    
    function setCalendarView(view) {
      if (calendar) {
        const viewMap = {
          'month': 'dayGridMonth',
          'week': 'timeGridWeek',
          'day': 'timeGridDay'
        };
        calendar.changeView(viewMap[view]);
        currentCalendarView = view;
        
        // Update active button
        document.querySelectorAll('.calendar-views .btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
      }
    }
    
    async function loadUpcomingEvents() {
      if (!currentClass) return;
      
      try {
        const response = await fetch(`/api/schedule/class/${currentClass._id}/upcoming?limit=5`);
        if (!response.ok) throw new Error('Failed to load upcoming events');
        
        const events = await response.json();
        const container = document.getElementById('upcomingEventsList');
        container.innerHTML = '';
        
        events.forEach(event => {
          const eventEl = document.createElement('div');
          eventEl.className = 'event-item';
          eventEl.innerHTML = `
            <div class="event-info">
              <h4>${event.title}</h4>
              <p>${event.type} • ${formatDate(event.startDate)}</p>
            </div>
            <div class="event-actions">
              <button class="btn btn-sm" onclick="editEvent('${event._id}')">
                <i class="fas fa-edit"></i>
              </button>
            </div>
          `;
          container.appendChild(eventEl);
        });
        
      } catch (error) {
        console.error('❌ Failed to load upcoming events:', error);
      }
    }
    
    async function loadTodaysSchedule() {
      if (!currentClass) return;
      
      try {
        const response = await fetch(`/api/schedule/class/${currentClass._id}/today`);
        if (!response.ok) throw new Error('Failed to load today\'s schedule');
        
        const events = await response.json();
        const container = document.getElementById('todaysSchedule');
        container.innerHTML = '';
        
        events.forEach(event => {
          const eventEl = document.createElement('div');
          eventEl.className = 'schedule-item';
          eventEl.innerHTML = `
            <div class="schedule-time">${formatTime(event.startDate)}</div>
            <div class="schedule-content">
              <h4>${event.title}</h4>
              <p>${event.description || ''}</p>
              <span class="event-type">${event.type}</span>
            </div>
          `;
          container.appendChild(eventEl);
        });
        
      } catch (error) {
        console.error('❌ Failed to load today\'s schedule:', error);
      }
    }
    
    // ===== COLLABORATION FUNCTIONS =====
    
    async function createWhiteboard() {
      const form = document.getElementById('whiteboardForm');
      const formData = new FormData(form);
      
      try {
        const response = await fetch('/api/collaboration/whiteboards', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            title: formData.get('title'),
            description: formData.get('description'),
            classId: currentClass._id,
            permissions: {
              allowStudentEdit: formData.get('allowStudentEdit') === 'on',
              moderatedMode: formData.get('moderatedMode') === 'on'
            }
          })
        });
        
        if (!response.ok) throw new Error('Failed to create whiteboard');
        
        const whiteboard = await response.json();
        closeModal('whiteboardModal');
        showAlert('Whiteboard created successfully', 'success');
        
        // Open whiteboard in new window/tab
        window.open(`/whiteboard.html?id=${whiteboard._id}`, '_blank');
        
      } catch (error) {
        console.error('❌ Failed to create whiteboard:', error);
        showAlert('Failed to create whiteboard', 'error');
      }
    }
    
    async function createInteractiveExercise() {
      const form = document.getElementById('exerciseForm');
      const formData = new FormData(form);
      
      // Collect questions data
      const questions = [];
      document.querySelectorAll('.question-item').forEach(questionEl => {
        const questionData = {
          type: questionEl.querySelector('[name="questionType"]').value,
          question: questionEl.querySelector('[name="questionText"]').value,
          points: parseInt(questionEl.querySelector('[name="questionPoints"]').value) || 1
        };
        
        // Add type-specific data
        if (questionData.type === 'multiple-choice') {
          questionData.options = [];
          questionEl.querySelectorAll('.option-item').forEach(optionEl => {
            questionData.options.push({
              text: optionEl.querySelector('[name="optionText"]').value,
              isCorrect: optionEl.querySelector('[name="isCorrect"]').checked
            });
          });
        }
        
        questions.push(questionData);
      });
      
      try {
        const response = await fetch('/api/collaboration/exercises', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            title: formData.get('title'),
            description: formData.get('description'),
            type: formData.get('type'),
            classId: currentClass._id,
            questions,
            settings: {
              timeLimit: parseInt(formData.get('timeLimit')) || 0
            }
          })
        });
        
        if (!response.ok) throw new Error('Failed to create exercise');
        
        const exercise = await response.json();
        closeModal('exerciseModal');
        showAlert('Interactive exercise created successfully', 'success');
        
      } catch (error) {
        console.error('❌ Failed to create exercise:', error);
        showAlert('Failed to create exercise', 'error');
      }
    }
    
    function addQuestion() {
      const container = document.getElementById('questionsContainer');
      const questionEl = document.createElement('div');
      questionEl.className = 'question-item';
      questionEl.innerHTML = `
        <div class="question-header">
          <h4>Question ${container.children.length + 1}</h4>
          <button type="button" class="btn btn-sm btn-danger" onclick="removeQuestion(this)">
            <i class="fas fa-trash"></i>
          </button>
        </div>
        <div class="form-group">
          <label class="form-label">Question Type</label>
          <select class="form-select" name="questionType" onchange="updateQuestionOptions(this)">
            <option value="multiple-choice">Multiple Choice</option>
            <option value="true-false">True/False</option>
            <option value="short-answer">Short Answer</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Question Text</label>
          <textarea class="form-textarea" name="questionText" required></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Points</label>
          <input type="number" class="form-input" name="questionPoints" value="1" min="1">
        </div>
        <div class="question-options">
          <!-- Options will be added based on question type -->
        </div>
      `;
      container.appendChild(questionEl);
      
      // Initialize with multiple choice options
      updateQuestionOptions(questionEl.querySelector('[name="questionType"]'));
    }
    
    function removeQuestion(button) {
      button.closest('.question-item').remove();
    }
    
    function updateQuestionOptions(select) {
      const questionItem = select.closest('.question-item');
      const optionsContainer = questionItem.querySelector('.question-options');
      const type = select.value;
      
      optionsContainer.innerHTML = '';
      
      if (type === 'multiple-choice') {
        optionsContainer.innerHTML = `
          <label class="form-label">Answer Options</label>
          <div class="options-list">
            <div class="option-item">
              <input type="text" class="form-input" name="optionText" placeholder="Option 1" required>
              <label class="form-checkbox">
                <input type="radio" name="isCorrect">
                <span class="checkmark"></span>
                Correct
              </label>
            </div>
            <div class="option-item">
              <input type="text" class="form-input" name="optionText" placeholder="Option 2" required>
              <label class="form-checkbox">
                <input type="radio" name="isCorrect">
                <span class="checkmark"></span>
                Correct
              </label>
            </div>
          </div>
          <button type="button" class="btn btn-sm" onclick="addOption(this)">Add Option</button>
        `;
      } else if (type === 'true-false') {
        optionsContainer.innerHTML = `
          <label class="form-label">Correct Answer</label>
          <select class="form-select" name="correctAnswer">
            <option value="true">True</option>
            <option value="false">False</option>
          </select>
        `;
      }
    }
    
    function addOption(button) {
      const optionsList = button.previousElementSibling;
      const optionCount = optionsList.children.length + 1;
      const optionEl = document.createElement('div');
      optionEl.className = 'option-item';
      optionEl.innerHTML = `
        <input type="text" class="form-input" name="optionText" placeholder="Option ${optionCount}" required>
        <label class="form-checkbox">
          <input type="radio" name="isCorrect">
          <span class="checkmark"></span>
          Correct
        </label>
        <button type="button" class="btn btn-sm btn-danger" onclick="removeOption(this)">
          <i class="fas fa-trash"></i>
        </button>
      `;
      optionsList.appendChild(optionEl);
    }
    
    function removeOption(button) {
      button.closest('.option-item').remove();
    }
    
    // Add event listeners for new forms
    document.addEventListener('DOMContentLoaded', function() {
      // Event form submission
      document.getElementById('eventForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const formData = new FormData(e.target);
        const eventData = {
          title: formData.get('title'),
          description: formData.get('description'),
          type: formData.get('type'),
          startDate: formData.get('startDate'),
          endDate: formData.get('endDate'),
          allDay: formData.get('allDay') === 'on',
          location: formData.get('location'),
          virtualMeeting: {
            joinUrl: formData.get('virtualMeetingUrl')
          },
          priority: formData.get('priority'),
          visibility: formData.get('visibility'),
          classId: currentClass._id
        };
        
        try {
          const response = await fetch('/api/schedule/events', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(eventData)
          });
          
          if (!response.ok) throw new Error('Failed to create event');
          
          closeModal('eventModal');
          loadSchedule();
          showAlert('Event created successfully', 'success');
          
        } catch (error) {
          console.error('❌ Failed to create event:', error);
          showAlert('Failed to create event', 'error');
        }
      });
      
      // Whiteboard form submission
      document.getElementById('whiteboardForm').addEventListener('submit', (e) => {
        e.preventDefault();
        createWhiteboard();
      });
      
      // Exercise form submission
      document.getElementById('exerciseForm').addEventListener('submit', (e) => {
        e.preventDefault();
        createInteractiveExercise();
      });
    });
  </script>
</body>
</html>