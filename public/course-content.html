<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SMX KITS - Course Content</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
      --secondary-gradient: linear-gradient(135deg, #ff8c42 0%, #ff6b35 100%);
      --accent-gradient: linear-gradient(135deg, #ffa726 0%, #ff9800 100%);
      --dark-gradient: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 100%);
      --card-gradient: linear-gradient(145deg, #2d1810 0%, #1a0f08 100%);
      --glass-bg: rgba(255, 255, 255, 0.05);
      --glass-border: rgba(255, 255, 255, 0.1);
      --text-primary: #ffffff;
      --text-secondary: #b8c5d6;
      --text-accent: #ffa726;
      --shadow-primary: 0 20px 40px rgba(0, 0, 0, 0.3);
      --shadow-hover: 0 30px 60px rgba(0, 0, 0, 0.4);
      --border-radius: 20px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--dark-gradient);
      color: var(--text-primary);
      overflow-x: hidden;
      line-height: 1.6;
      min-height: 100vh;
    }

    /* Animated background particles */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 80%, rgba(255, 107, 53, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(247, 147, 30, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(255, 140, 66, 0.1) 0%, transparent 50%);
      z-index: -1;
      animation: float 20s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      33% { transform: translateY(-20px) rotate(1deg); }
      66% { transform: translateY(10px) rotate(-1deg); }
    }

    /* Top Navigation Bar */
    .top-navbar {
      background: rgba(15, 20, 25, 0.95);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--glass-border);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .navbar-brand {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .navbar-logo {
      height: 40px;
      filter: drop-shadow(0 5px 15px rgba(255, 107, 53, 0.3));
    }

    .navbar-title {
      font-size: 1.5rem;
      font-weight: 700;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .navbar-nav {
      display: flex;
      align-items: center;
      gap: 2rem;
    }

    .nav-link {
      color: var(--text-secondary);
      text-decoration: none;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .nav-link:hover {
      color: var(--text-primary);
      background: var(--glass-bg);
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.5rem 1rem;
      background: var(--glass-bg);
      border-radius: 25px;
      border: 1px solid var(--glass-border);
    }

    .user-avatar {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      background: var(--accent-gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1rem;
    }

    /* Main Content */
    .course-content {
      padding: 2rem;
      max-width: 1400px;
      margin: 0 auto;
    }

    .course-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .course-title {
      font-size: 2.5rem;
      font-weight: 800;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
    }

    .course-subtitle {
      color: var(--text-secondary);
      font-size: 1.1rem;
    }

    /* Slideshow Container */
    .slideshow-container {
      background: var(--card-gradient);
      border-radius: var(--border-radius);
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-primary);
      margin-bottom: 2rem;
      overflow: hidden;
      position: relative;
    }

    .slideshow-header {
      padding: 1.5rem 2rem;
      background: var(--glass-bg);
      border-bottom: 1px solid var(--glass-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .module-selector {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .module-select {
      background: var(--card-gradient);
      color: var(--text-primary);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      cursor: pointer;
      transition: var(--transition);
    }

    .module-select:focus {
      outline: none;
      border-color: var(--text-accent);
      box-shadow: 0 0 10px rgba(255, 167, 38, 0.3);
    }

    .slide-info {
      display: flex;
      align-items: center;
      gap: 1rem;
      color: var(--text-secondary);
    }

    .slide-viewer {
      position: relative;
      height: 70vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
    }

    .slide-image {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      transition: var(--transition);
    }

    .slide-controls {
      padding: 1.5rem 2rem;
      background: var(--glass-bg);
      border-top: 1px solid var(--glass-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .slide-nav {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .slide-control-btn {
      background: var(--primary-gradient);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .slide-control-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
    }

    .slide-control-btn:disabled {
      background: rgba(255, 255, 255, 0.1);
      cursor: not-allowed;
      transform: none;
    }

    .slide-counter {
      color: var(--text-primary);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: var(--glass-bg);
      padding: 0.75rem 1.5rem;
      border-radius: 25px;
      border: 1px solid var(--glass-border);
    }

    .slide-tools {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .tool-btn {
      background: var(--glass-bg);
      color: var(--text-accent);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      padding: 0.75rem;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      width: 45px;
      height: 45px;
    }

    .tool-btn:hover {
      background: var(--primary-gradient);
      color: white;
      transform: translateY(-2px);
    }

    .tool-btn.active {
      background: var(--primary-gradient);
      color: white;
    }

    /* Notes Panel */
    .notes-panel {
      position: absolute;
      bottom: 100%;
      left: 0;
      right: 0;
      background: var(--card-gradient);
      border: 1px solid var(--glass-border);
      border-bottom: none;
      border-radius: var(--border-radius) var(--border-radius) 0 0;
      max-height: 0;
      overflow: hidden;
      transition: all 0.3s ease;
      z-index: 10;
    }

    .notes-panel.expanded {
      max-height: 400px;
    }

    .notes-tabs {
      display: flex;
      border-bottom: 1px solid var(--glass-border);
    }

    .notes-tab {
      flex: 1;
      padding: 1rem;
      background: var(--glass-bg);
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      transition: var(--transition);
      font-weight: 500;
    }

    .notes-tab.active {
      background: var(--primary-gradient);
      color: white;
    }

    .notes-content {
      padding: 1.5rem;
      height: 300px;
      overflow-y: auto;
    }

    .instructor-notes {
      color: var(--text-secondary);
      line-height: 1.6;
    }

    .student-notes {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .student-notes-input {
      width: 100%;
      min-height: 200px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      padding: 1rem;
      color: var(--text-primary);
      font-family: inherit;
      resize: vertical;
      transition: var(--transition);
    }

    .student-notes-input:focus {
      outline: none;
      border-color: var(--text-accent);
      box-shadow: 0 0 10px rgba(255, 167, 38, 0.3);
    }

    .notes-actions {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
    }

    .btn-save {
      background: var(--primary-gradient);
      color: white;
      border: none;
      border-radius: 6px;
      padding: 0.5rem 1rem;
      cursor: pointer;
      transition: var(--transition);
    }

    .btn-save:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
    }

    /* General Module Notes */
    .module-notes-section {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border-radius: var(--border-radius);
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-primary);
      margin-bottom: 2rem;
      overflow: hidden;
    }

    .module-notes-header {
      padding: 1.5rem 2rem;
      background: var(--card-gradient);
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: var(--transition);
    }

    .module-notes-header:hover {
      background: linear-gradient(145deg, #3d2818 0%, #2a1510 100%);
    }

    .module-notes-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--text-accent);
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .module-notes-toggle {
      font-size: 1.2rem;
      color: var(--text-accent);
      transition: var(--transition);
    }

    .module-notes-content {
      padding: 0 2rem;
      max-height: 0;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .module-notes-content.expanded {
      padding: 2rem;
      max-height: 500px;
    }

    .module-notes-input {
      width: 100%;
      min-height: 150px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      padding: 1rem;
      color: var(--text-primary);
      font-family: inherit;
      resize: vertical;
      transition: var(--transition);
    }

    .module-notes-input:focus {
      outline: none;
      border-color: var(--text-accent);
      box-shadow: 0 0 10px rgba(255, 167, 38, 0.3);
    }



    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--accent-gradient);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--primary-gradient);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .top-navbar {
        padding: 1rem;
        flex-direction: column;
        gap: 1rem;
      }
      
      .course-content {
        padding: 1rem;
      }
      
      .course-title {
        font-size: 2rem;
      }
      
      .slideshow-header {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
      }
      
      .slide-viewer {
        height: 50vh;
      }

      .slide-controls {
        flex-direction: column;
        gap: 1rem;
      }

      .slide-nav {
        order: 2;
      }

      .slide-tools {
        order: 1;
      }
    }
  </style>
</head>
<body>
  <!-- Authentication Check -->
  <script>
    // Immediate authentication check
    const token = localStorage.getItem('token');
    const role = localStorage.getItem('role');
    
    if (!token || !role) {
      // No authentication found, redirect immediately
      window.location.replace('/login.html');
      // Stop execution to prevent content from loading
      throw new Error('Authentication required');
    }
    
    // We are authenticated, continue loading
    console.log('✅ Authentication verified - loading course content');
  </script>

  <!-- Top Navigation Bar -->
  <nav class="top-navbar">
    <div class="navbar-brand">
      <img src="SMXKITS.png" alt="SMXKITS Logo" class="navbar-logo" />
      <span class="navbar-title">Course Content</span>
    </div>
    <div class="navbar-nav">
      <a href="dashboard.html" class="nav-link">
        <i class="fas fa-tachometer-alt"></i>
        Dashboard
      </a>
      <div class="user-info">
        <div class="user-avatar" id="userAvatar">S</div>
        <span id="studentName">Student</span>
      </div>
      <a href="#" onclick="logout()" class="nav-link">
        <i class="fas fa-sign-out-alt"></i>
        Logout
      </a>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="course-content">
    <!-- Course Header -->
    <div class="course-header">
      <h1 class="course-title" id="courseTitle">INTRODUCTION TO FMV</h1>
      <p class="course-subtitle">Interactive training modules with comprehensive content</p>
    </div>

    <!-- Slideshow Container -->
    <div class="slideshow-container">
      <!-- Notes Panel (Hidden by default) -->
      <div class="notes-panel" id="notesPanel">
        <div class="notes-tabs">
          <button class="notes-tab active" onclick="switchNotesTab('instructor')">
            <i class="fas fa-chalkboard-teacher"></i>
            Instructor Notes
          </button>
          <button class="notes-tab" onclick="switchNotesTab('student')">
            <i class="fas fa-sticky-note"></i>
            My Notes
          </button>
        </div>
        <div class="notes-content">
          <div id="instructorNotesContent" class="instructor-notes">
            <p>Instructor notes for this slide will appear here...</p>
          </div>
          <div id="studentNotesContent" class="student-notes" style="display: none;">
            <textarea 
              id="studentNotesInput" 
              class="student-notes-input" 
              placeholder="Add your notes for this slide..."
            ></textarea>
            <div class="notes-actions">
              <button class="btn-save" onclick="saveStudentNotes()">
                <i class="fas fa-save"></i>
                Save Notes
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Slideshow Header -->
      <div class="slideshow-header">
        <div class="module-selector">
          <label for="moduleSelect">
            <i class="fas fa-layer-group"></i>
            Module:
          </label>
          <select id="moduleSelect" class="module-select">
            <option value="fmv">INTRODUCTION TO FMV</option>
            <option value="f3ead">F3EAD</option>
          </select>
        </div>
        <div class="slide-info">
          <i class="fas fa-images"></i>
          <span>Slide <span id="currentSlideNum">1</span> of <span id="totalSlides">20</span></span>
        </div>
      </div>

      <!-- Slide Viewer -->
      <div class="slide-viewer">
        <img id="currentSlide" class="slide-image" src="" alt="Current Slide" />
      </div>

      <!-- Slide Controls -->
      <div class="slide-controls">
        <div class="slide-nav">
          <button id="prevSlide" class="slide-control-btn">
            <i class="fas fa-chevron-left"></i>
            Previous
          </button>
          <button id="nextSlide" class="slide-control-btn">
            Next
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>

        <div class="slide-counter">
          <i class="fas fa-presentation"></i>
          <span id="slideProgress">1 / 20</span>
        </div>

        <div class="slide-tools">
          <button class="tool-btn" id="notesBtn" onclick="toggleNotesPanel()" title="Toggle Notes">
            <i class="fas fa-sticky-note"></i>
          </button>
          <button class="tool-btn" onclick="toggleFullscreen()" title="Fullscreen">
            <i class="fas fa-expand"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- General Module Notes -->
    <div class="module-notes-section">
      <div class="module-notes-header" onclick="toggleModuleNotes()">
        <div class="module-notes-title">
          <i class="fas fa-book"></i>
          General Module Notes
        </div>
        <i class="fas fa-chevron-down module-notes-toggle" id="moduleNotesToggle"></i>
      </div>
      <div class="module-notes-content" id="moduleNotesContent">
        <textarea 
          id="moduleNotesInput" 
          class="module-notes-input" 
          placeholder="Add your general notes for this module..."
        ></textarea>
        <div class="notes-actions" style="margin-top: 1rem;">
          <button class="btn-save" onclick="saveModuleNotes()">
            <i class="fas fa-save"></i>
            Save Module Notes
          </button>
        </div>
      </div>
    </div>
  </main>

  <!-- JavaScript for Course Content -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Set student name and avatar if available
      const studentName = localStorage.getItem('studentName') || 'Student';
      document.getElementById('studentName').textContent = studentName;
      document.getElementById('userAvatar').textContent = studentName.charAt(0).toUpperCase();

      // Slide configuration for different modules
      const modules = {
        fmv: {
          title: 'INTRODUCTION TO FMV',
          slideCount: 20,
          basePath: 'INTRODUCTION TO FMV/',
          slides: [
            'SLIDE 1.jpg', 'SLIDE 2.jpg', 'SLIDE 3.jpg', 'SLIDE 4.jpg', 'SLIDE 5.jpg',
            'SLIDE 6.jpg', 'SLIDE 7.jpg', 'SLIDE 8.jpg', 'SLIDE 9.jpg', 'SLIDE 10.jpg',
            'SLIDE 11.jpg', 'SLIDE 12.jpg', 'SLIDE 13.jpg', 'SLIDE 14.jpg', 'SLIDE 15.jpg',
            'SLIDE 16.jpg', 'SLIDE 17.jpg', 'SLIDE 18.jpg', 'SLIDE 19.jpg', 'SLIDE 20.jpg'
          ],
          instructorNotes: {
            1: "Welcome to the Introduction to FMV course. This slide introduces the fundamental concepts of Full Motion Video analysis.",
            2: "Explain the importance of FMV in modern intelligence operations and surveillance.",
            3: "Discuss the technical specifications and requirements for FMV systems.",
            4: "Cover the basic principles of video compression and streaming.",
            5: "Introduce the different types of sensors used in FMV collection."
          }
        },
        f3ead: {
          title: 'F3EAD',
          slideCount: 37,
          basePath: 'F3EAD/F3EAD/',
          slides: [
            'SLIDE 1.jpg', 'SLIDE 2.jpg', 'SLIDE 3.jpg', 'SLIDE 4.jpg', 'SLIDE 5.jpg',
            'SLIDE 6.jpg', 'SLIDE 7.jpg', 'SLIDE 8.jpg', 'SLIDE 9.jpg', 'SLIDE 10.jpg',
            'SLIDE 11.jpg', 'SLIDE 12.jpg', 'SLIDE 13.jpg', 'SLIDE 14.jpg', 'SLIDE 15.jpg',
            'SLIDE 16.jpg', 'SLIDE 17.jpg', 'SLIDE 18.jpg', 'SLIDE 19.jpg', 'SLIDE 20.jpg',
            'SLIDE 21.jpg', 'SLIDE 22.jpg', 'SLIDE 23.jpg', 'SLIDE 24.jpg', 'SLIDE 25.jpg',
            'SLIDE 26.jpg', 'SLIDE 27.jpg', 'SLIDE 28.jpg', 'SLIDE 29.jpg', 'SLIDE 30.jpg',
            'SLIDE 31.jpg', 'SLIDE 32.jpg', 'SLIDE 33.jpg', 'SLIDE 34.jpg', 'SLIDE 35.jpg',
            'SLIDE 36.jpg', 'SLIDE 37.jpg'
          ],
          instructorNotes: {
            1: "Introduction to F3EAD - Find, Fix, Finish, Exploit, Analyze, Disseminate methodology.",
            2: "Explain the Find phase - locating targets and areas of interest.",
            3: "Detail the Fix phase - confirming target location and characteristics.",
            4: "Cover the Finish phase - executing the mission or operation.",
            5: "Discuss the Exploit phase - gathering intelligence from the operation."
          }
        }
      };

      // Current state
      let currentModule = 'fmv';
      let currentSlide = 1;
      let activeNotesTab = 'instructor';
      
      // DOM elements
      const currentSlideEl = document.getElementById('currentSlide');
      const currentSlideNumEl = document.getElementById('currentSlideNum');
      const totalSlidesEl = document.getElementById('totalSlides');
      const slideProgressEl = document.getElementById('slideProgress');
      const moduleSelectEl = document.getElementById('moduleSelect');
      const courseTitle = document.getElementById('courseTitle');
      const prevBtn = document.getElementById('prevSlide');
      const nextBtn = document.getElementById('nextSlide');
      const notesPanel = document.getElementById('notesPanel');
      const notesBtn = document.getElementById('notesBtn');
      
      // Initialize the viewer
      updateModuleInfo();
      updateSlideDisplay();
      loadStudentNotes();
      loadModuleNotes();
      
      // Event Listeners
      moduleSelectEl.addEventListener('change', function() {
        currentModule = this.value;
        currentSlide = 1;
        updateModuleInfo();
        updateSlideDisplay();
        updateCourseTitle();
        loadStudentNotes();
        loadModuleNotes();
      });
      
      prevBtn.addEventListener('click', function() {
        if (currentSlide > 1) {
          saveCurrentSlideNotes();
          currentSlide--;
          updateSlideDisplay();
          loadStudentNotes();
        }
      });
      
      nextBtn.addEventListener('click', function() {
        if (currentSlide < modules[currentModule].slideCount) {
          saveCurrentSlideNotes();
          currentSlide++;
          updateSlideDisplay();
          loadStudentNotes();
        }
      });
      
      // Key navigation
      document.addEventListener('keydown', function(e) {
        if (e.key === 'ArrowLeft' && currentSlide > 1) {
          prevBtn.click();
        } else if (e.key === 'ArrowRight' && currentSlide < modules[currentModule].slideCount) {
          nextBtn.click();
        } else if (e.key === 'Escape') {
          closeNotesPanel();
        }
      });
      
      // Functions
      function updateModuleInfo() {
        const module = modules[currentModule];
        totalSlidesEl.textContent = module.slideCount;
        currentSlideNumEl.textContent = currentSlide;
        slideProgressEl.textContent = `${currentSlide} / ${module.slideCount}`;
      }

      function updateCourseTitle() {
        const module = modules[currentModule];
        courseTitle.textContent = module.title;
      }
      
      function updateSlideDisplay() {
        const module = modules[currentModule];
        const slideFileName = module.slides[currentSlide - 1];
        
        // Build the path with proper encoding
        const rawPath = `${module.basePath}${slideFileName}`;
        
        // Try different encoding methods
        const paths = [
          rawPath.replace(/ /g, '%20'),  // Manual space encoding
          encodeURI(rawPath),            // Standard URI encoding
          rawPath                        // Raw path (browser might handle it)
        ];
        
        console.log('=== Slide Display Debug ===');
        console.log('Module:', currentModule);
        console.log('Slide:', currentSlide);
        console.log('Raw path:', rawPath);
        console.log('Trying paths:', paths);
        
        let pathIndex = 0;
        
        function tryNextPath() {
          if (pathIndex < paths.length) {
            const currentPath = paths[pathIndex];
            console.log(`Trying path ${pathIndex + 1}:`, currentPath);
            currentSlideEl.src = currentPath;
            pathIndex++;
          } else {
            console.error('❌ All paths failed for slide:', slideFileName);
            currentSlideEl.style.opacity = '1';
          }
        }
        
        currentSlideEl.onload = function() {
          this.style.opacity = '1';
          console.log('✅ Image loaded successfully:', this.src);
        };
        
        currentSlideEl.onerror = function() {
          console.log(`❌ Path failed: ${this.src}`);
          tryNextPath();
        };
        
        // Start with the first path
        currentSlideEl.style.opacity = '0.5';
        tryNextPath();
        
        // Update UI
        updateModuleInfo();
        prevBtn.disabled = currentSlide === 1;
        nextBtn.disabled = currentSlide === module.slideCount;
        
        // Update instructor notes
        updateInstructorNotes();
      }

      function updateInstructorNotes() {
        const module = modules[currentModule];
        const instructorNotesContent = document.getElementById('instructorNotesContent');
        const notes = module.instructorNotes && module.instructorNotes[currentSlide] 
          ? module.instructorNotes[currentSlide] 
          : 'No instructor notes available for this slide.';
        instructorNotesContent.innerHTML = `<p>${notes}</p>`;
      }

      function toggleNotesPanel() {
        const isExpanded = notesPanel.classList.contains('expanded');
        if (isExpanded) {
          closeNotesPanel();
        } else {
          openNotesPanel();
        }
      }

      function openNotesPanel() {
        notesPanel.classList.add('expanded');
        notesBtn.classList.add('active');
      }

      function closeNotesPanel() {
        notesPanel.classList.remove('expanded');
        notesBtn.classList.remove('active');
      }

      function switchNotesTab(tab) {
        activeNotesTab = tab;
        const tabs = document.querySelectorAll('.notes-tab');
        tabs.forEach(t => t.classList.remove('active'));
        
        if (tab === 'instructor') {
          tabs[0].classList.add('active');
          document.getElementById('instructorNotesContent').style.display = 'block';
          document.getElementById('studentNotesContent').style.display = 'none';
        } else {
          tabs[1].classList.add('active');
          document.getElementById('instructorNotesContent').style.display = 'none';
          document.getElementById('studentNotesContent').style.display = 'block';
        }
      }

      function saveStudentNotes() {
        const notes = document.getElementById('studentNotesInput').value;
        const key = `studentNotes_${currentModule}_slide_${currentSlide}`;
        localStorage.setItem(key, notes);
        
        // Show save confirmation
        const saveBtn = event.target;
        const originalText = saveBtn.innerHTML;
        saveBtn.innerHTML = '<i class="fas fa-check"></i> Saved!';
        setTimeout(() => {
          saveBtn.innerHTML = originalText;
        }, 2000);
      }

      function loadStudentNotes() {
        const key = `studentNotes_${currentModule}_slide_${currentSlide}`;
        const notes = localStorage.getItem(key) || '';
        document.getElementById('studentNotesInput').value = notes;
      }

      function saveCurrentSlideNotes() {
        if (activeNotesTab === 'student') {
          const notes = document.getElementById('studentNotesInput').value;
          const key = `studentNotes_${currentModule}_slide_${currentSlide}`;
          localStorage.setItem(key, notes);
        }
      }

      function saveModuleNotes() {
        const notes = document.getElementById('moduleNotesInput').value;
        const key = `moduleNotes_${currentModule}`;
        localStorage.setItem(key, notes);
        
        // Show save confirmation
        const saveBtn = event.target;
        const originalText = saveBtn.innerHTML;
        saveBtn.innerHTML = '<i class="fas fa-check"></i> Saved!';
        setTimeout(() => {
          saveBtn.innerHTML = originalText;
        }, 2000);
      }

      function loadModuleNotes() {
        const key = `moduleNotes_${currentModule}`;
        const notes = localStorage.getItem(key) || '';
        document.getElementById('moduleNotesInput').value = notes;
      }

      function toggleFullscreen() {
        if (!document.fullscreenElement) {
          document.documentElement.requestFullscreen();
        } else {
          document.exitFullscreen();
        }
      }

      // Make functions globally available
      window.switchNotesTab = switchNotesTab;
      window.saveStudentNotes = saveStudentNotes;
      window.saveModuleNotes = saveModuleNotes;
      window.toggleNotesPanel = toggleNotesPanel;
      window.toggleFullscreen = toggleFullscreen;
    });

    // Module Notes Toggle
    function toggleModuleNotes() {
      const moduleNotesContent = document.getElementById('moduleNotesContent');
      const moduleNotesToggle = document.getElementById('moduleNotesToggle');
      
      if (moduleNotesContent.classList.contains('expanded')) {
        moduleNotesContent.classList.remove('expanded');
        moduleNotesToggle.style.transform = 'rotate(0deg)';
      } else {
        moduleNotesContent.classList.add('expanded');
        moduleNotesToggle.style.transform = 'rotate(180deg)';
      }
    }

    // Logout function
    function logout() {
      localStorage.removeItem('token');
      localStorage.removeItem('role');
      localStorage.removeItem('studentName');
      window.location.replace('/login.html');
    }
  </script>
</body>
</html>