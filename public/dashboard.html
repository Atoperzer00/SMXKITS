<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SMX KITS - Dashboard</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="keyboard-training.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="typing-progress.js"></script>
</head>
<body class="bg-[#0f172a] text-white">
  <!-- Authentication Check - This runs BEFORE any content loads -->
  <script>
    // Immediate authentication check
    const token = localStorage.getItem('token');
    const role = localStorage.getItem('role');
    
    if (!token || !role) {
      // No authentication found, redirect immediately
      window.location.replace('/login.html');
      // Stop execution to prevent content from loading
      throw new Error('Authentication required');
    }
    
    // We are authenticated, continue loading dashboard
    console.log('‚úÖ Authentication verified - loading student dashboard');
  </script>

  <!-- Scrollable FMV overlay (hidden by default) -->
  <div id="fmvOverlay" class="fmv-overlay">
    <button id="closeFmvOverlay" class="close-overlay-btn">√ó</button>
    <div class="fmv-window">
      <div class="image-window">
        <div class="scroll-container" id="scrollArea">
          <img src="FMV_SAMPLE.jpg" alt="FMV Sample" class="scroll-image" />
        </div>
      </div>
      <div class="hud-overlay">
        <div class="hud-top">
          <div class="hud-item">
            <span class="hud-label">MISSION:</span>
            <span class="hud-value" id="mission">OVERWATCH</span>
          </div>
          <div class="hud-item">
            <span class="hud-label">GRID:</span>
            <span class="hud-value" id="grid">38S MD 12345 67890</span>
          </div>
          <div class="hud-item">
            <span class="hud-label">ELEV:</span>
            <span class="hud-value" id="elevation">1,234 FT MSL</span>
          </div>
        </div>
        <div class="hud-bottom">
          <div class="hud-item">
            <span class="hud-label">TIME:</span>
            <span class="hud-value" id="clock-time">12:34:56</span>
          </div>
          <div class="hud-item">
            <span class="hud-label">SENSOR:</span>
            <span class="hud-value" id="sensor">EO/IR</span>
          </div>
          <div class="hud-item">
            <span class="hud-label">MODE:</span>
            <span class="hud-value" id="mode">WIDE</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Dashboard Content -->
  <section id="screen-home" class="screen active">
    <div class="min-h-screen flex font-sans">
      <!-- Sidebar -->
      <aside class="flex flex-col w-60 bg-black/60 rounded-3xl m-6 p-4 shadow-2xl">
        <div class="flex flex-col items-center mb-8">
          <div class="w-16 h-16 rounded-full bg-gradient-to-br from-zinc-900 via-zinc-700 to-zinc-900 flex items-center justify-center shadow-lg mb-2">
            <img src="SE66806_logo_orig.png" alt="SMXKITS Logo" class="w-12 h-12" />
          </div>
        </div>
        <nav class="flex-1 space-y-5 text-zinc-200 font-medium">
          <a href="#" onclick="event.preventDefault(); window.location.reload();" class="flex items-center gap-3 px-4 py-2 rounded-xl hover:bg-zinc-800/80 transition"><span>üè†</span>Dashboard</a>
          <a href="#" onclick="goToPEDTraining();" class="flex items-center gap-3 px-4 py-2 rounded-xl hover:bg-zinc-800/80 transition"><span>üõ´</span>Live PED Exercise</a>
          <a href="#" onclick="goToKITS();" class="flex items-center gap-3 px-4 py-2 rounded-xl hover:bg-zinc-800/80 transition"><span>‚å®Ô∏è</span>Keyboard Input Training</a>
          <a href="#" onclick="goToPEDTraining();" class="flex items-center gap-3 px-4 py-2 rounded-xl hover:bg-zinc-800/80 transition"><span>üßë‚Äçüíª</span>Screener Training</a>
          <a href="#" onclick="goToISRTraining();" class="flex items-center gap-3 px-4 py-2 rounded-xl hover:bg-zinc-800/80 transition"><span>üì°</span>IA Training</a>
          <a href="#" onclick="goToOpsLog();" class="flex items-center gap-3 px-4 py-2 rounded-xl hover:bg-zinc-800/80 transition"><span>üìù</span>Grading</a>
          <a href="#" class="flex items-center gap-3 px-4 py-2 rounded-xl hover:bg-zinc-800/80 transition"><span>üìÖ</span>Schedule</a>
          <a href="#" class="flex items-center gap-3 px-4 py-2 rounded-xl hover:bg-zinc-800/80 transition"><span>üí¨</span>Feedback</a>
        </nav>
        <a href="#" onclick="logout();" class="mt-auto flex items-center gap-3 px-4 py-2 rounded-xl bg-zinc-900/80 text-red-400 hover:bg-red-900/50 transition">Logout</a>
      </aside>
      
      <!-- Main Content -->
      <main class="flex-1 p-8 pr-16">
        <!-- Top bar -->
        <div class="flex justify-between items-center mb-8">
          <div>
            <div class="text-2xl font-bold text-white mb-1">Welcome back, <span id="studentName">Student</span>!</div>
            <div class="text-base text-zinc-400">Access live training, modules, progress, and instructor info here.</div>
          </div>
          <div class="flex items-center gap-6">
            <!-- Notification bell -->
            <div class="relative">
              <button id="notifBtn" class="w-11 h-11 bg-zinc-900/80 rounded-full flex items-center justify-center text-white shadow-lg hover:bg-blue-700/70 transition text-xl">
                üîî
              </button>
              <!-- Notification popup (hidden by default) -->
              <div id="notifPopup" class="hidden absolute right-0 mt-3 w-80 bg-zinc-900/95 rounded-xl shadow-2xl p-4">
                <div class="font-semibold text-white mb-2">Notifications</div>
                <div class="text-zinc-400 text-sm">No new notifications.</div>
              </div>
            </div>
            
            <!-- Daily Notice Pop-out Button -->
            <button id="dailyNoticeBtn" class="w-11 h-11 bg-zinc-900/80 rounded-full flex items-center justify-center text-white shadow-lg hover:bg-blue-700/70 transition text-xl ml-2" title="Show Daily Notice">
              üóíÔ∏è
            </button>
            <!-- User info / day -->
            <div class="flex flex-col items-end">
              <span class="font-semibold text-white" id="studentDay">Day 3/7</span>
              <span class="text-sm text-zinc-400 mt-1">Your progress is on track</span>
            </div>
          </div>
        </div>
        
        <!-- Main bubble card -->
        <div class="w-full bg-zinc-900/90 rounded-3xl p-8 shadow-2xl flex items-center gap-8 mb-8">
          <img src="SE66806_logo_orig.png" class="w-28 h-28 rounded-3xl shadow-xl border-4 border-zinc-800" alt="Student Avatar" />
          <div>
            <div class="text-2xl font-bold text-white mb-2">Welcome to SMX KITS!</div>
            <div class="text-zinc-400 text-lg">Your student portal for real-time ISR training. Dive into live PED, practice with KITS, and monitor your course progress all in one place.</div>
          </div>
        </div>
        
        <!-- Training Links (bubble cards) -->
        <!-- First row of training cards -->
        <div class="grid grid-cols-3 gap-8 mb-10">
          <div onclick="goToKITS();" class="bg-zinc-800/80 rounded-3xl p-7 flex flex-col items-center shadow-xl cursor-pointer hover:scale-105 transition group">
            <img src="KIT CLICK LOGO.png" class="w-16 h-16 mb-2" alt="KITS" />
            <div class="font-semibold text-xl text-white mb-1">Resume Keyboard Input Training</div>
            <div class="text-zinc-400 text-sm group-hover:text-white">Pick up where you left off</div>
          </div>
          <div onclick="goToCourseContent();" class="bg-zinc-800/80 rounded-3xl p-7 flex flex-col items-center shadow-xl cursor-pointer hover:scale-105 transition group">
            <img src="COURSE REFERENCES LOGO.png" class="w-16 h-16 mb-2" alt="Course Content" />
            <div class="font-semibold text-xl text-white mb-1">Course Content</div>
            <div class="text-zinc-400 text-sm group-hover:text-white">View all training modules</div>
          </div>
          <div onclick="goToISRTraining();" class="bg-zinc-800/80 rounded-3xl p-7 flex flex-col items-center shadow-xl cursor-pointer hover:scale-105 transition group">
            <img src="ISR CLICK LOGO.png" class="w-16 h-16 mb-2" alt="Live ISR" />
            <div class="font-semibold text-xl text-white mb-1">Live ISR Training</div>
            <div class="text-zinc-400 text-sm group-hover:text-white">Access live operations & exercises</div>
          </div>
        </div>
        
        <!-- Second row of training cards -->
        <div class="grid grid-cols-3 gap-8 mb-10">
          <div onclick="goToScreenerTraining();" class="bg-zinc-800/80 rounded-3xl p-7 flex flex-col items-center shadow-xl cursor-pointer hover:scale-105 transition group">
            <img src="SCREENER LOGO.png" class="w-16 h-16 mb-2" alt="Screener Training" />
            <div class="font-semibold text-xl text-white mb-1">Screener Training</div>
            <div class="text-zinc-400 text-sm group-hover:text-white">Master real-time video analysis</div>
          </div>
          <div onclick="goToIATraining();" class="bg-zinc-800/80 rounded-3xl p-7 flex flex-col items-center shadow-xl cursor-pointer hover:scale-105 transition group">
            <img src="IA LOGO.png" class="w-16 h-16 mb-2" alt="IA Training" />
            <div class="font-semibold text-xl text-white mb-1">IA Training</div>
            <div class="text-zinc-400 text-sm group-hover:text-white">Enhance imagery analysis skills</div>
          </div>
          <div class="bg-zinc-800/80 rounded-3xl p-7 flex flex-col items-center shadow-xl group">
            <img src="INSTRUCTORS LOGO.png" class="w-16 h-16 mb-2" alt="Instructors" />
            <div class="font-semibold text-xl text-white mb-1">Instructors</div>
            <div class="flex items-center gap-2 mt-3">
              <img src="instructor1.jpg" onclick="showInstructorBio('Instructor 1')" title="Instructor 1" class="w-10 h-10 rounded-full border-2 border-white cursor-pointer hover:ring-4 hover:ring-blue-500 transition" />
              <img src="instructor2.jpg" onclick="showInstructorBio('Instructor 2')" title="Instructor 2" class="w-10 h-10 rounded-full border-2 border-white cursor-pointer hover:ring-4 hover:ring-blue-500 transition" />
            </div>
            <div class="text-zinc-400 text-xs mt-2">Click an instructor for bio</div>
          </div>
        </div>
        
        <!-- Course Progression -->
        <div class="bg-zinc-900/90 rounded-3xl p-8 shadow-2xl grid grid-cols-3 gap-8">
          <!-- Typing Progress -->
          <div>
            <div class="font-semibold text-white mb-2">Keyboard Input Training</div>
            <div class="w-full bg-zinc-700 rounded-full h-4 mb-2 overflow-hidden">
              <div id="typing-progress-bar" class="bg-yellow-400 h-4" style="width: 60%;"></div>
            </div>
            <div id="typing-progress-text" class="text-xs text-zinc-400">3 of 5 typing tests completed</div>
            
            <!-- WPM Stats -->
            <div class="mt-4 grid grid-cols-2 gap-4">
              <div class="bg-zinc-800/80 rounded-xl p-3">
                <div class="text-xs text-zinc-500 mb-1">Last WPM</div>
                <div class="text-2xl font-bold text-white"><span id="last-wpm">0</span></div>
              </div>
              <div class="bg-zinc-800/80 rounded-xl p-3">
                <div class="text-xs text-zinc-500 mb-1">Avg WPM</div>
                <div class="text-2xl font-bold text-white"><span id="avg-wpm">0</span></div>
              </div>
            </div>
          </div>
          
          <div>
            <div class="font-semibold text-white mb-2">Screener Training</div>
            <div class="w-full bg-zinc-700 rounded-full h-4 mb-2 overflow-hidden">
              <div class="bg-blue-500 h-4" style="width: 40%;"></div>
            </div>
            <div class="text-xs text-zinc-400">2 of 5 modules complete</div>
          </div>
          
          <div>
            <div class="font-semibold text-white mb-2">POL Typing Tests</div>
            <div class="w-full bg-zinc-700 rounded-full h-4 mb-2 overflow-hidden">
              <div class="bg-green-400 h-4" style="width: 20%;"></div>
            </div>
            <div class="text-xs text-zinc-400">1 of 5 modules complete</div>
          </div>
        </div>
        
        <!-- Daily Notice Popup (hidden by default) -->
        <div id="dailyNoticePopup" class="hidden fixed right-16 top-32 w-96 bg-zinc-900/95 rounded-2xl p-6 shadow-2xl z-50">
          <div class="flex justify-between items-center mb-2">
            <div class="font-semibold text-white">Daily Notice</div>
            <div>
              <button id="pinNotice" class="text-blue-400 mr-2" title="Pin Notice">üìå</button>
              <button id="closeNotice" class="text-zinc-400 hover:text-white text-lg" title="Close">√ó</button>
            </div>
          </div>
          <div class="text-zinc-400 text-sm">
            <b>Assignment due:</b> Upload all mission briefs by 1800Z.<br>
            <b>Schedule:</b> Live PED at 1300Z, IA review at 1530Z.
          </div>
        </div>
      </main>
    </div>
  </section>

<!-- Instructor bio popup logic -->
<script>
function showInstructorBio(name) {
  // Create overlay
  if(document.getElementById('bioOverlay')) return;
  const overlay = document.createElement('div');
  overlay.id = 'bioOverlay';
  overlay.style = 'position:fixed;top:0;left:0;width:100vw;height:100vh;background:#10151faa;z-index:2000;display:flex;align-items:center;justify-content:center;';
  overlay.onclick = function(e) { if(e.target===this) this.remove(); };
  // Centered bubble
  const bubble = document.createElement('div');
  bubble.style = 'background:#222831eb;border-radius:2rem;box-shadow:0 8px 44px #000c;padding:2.5rem 2.3rem;width:400px;max-width:95vw;color:#fff;text-align:center;display:flex;flex-direction:column;align-items:center;';
  bubble.innerHTML = `<img src="instructor1.jpg" style="width:88px;height:88px;border-radius:50%;border:3px solid #38bdf8;margin-bottom:1rem;"><div style="font-size:1.25rem;font-weight:bold;margin-bottom:0.4rem;">${name}</div><div style="font-size:1rem;color:#b8bdc7;margin-bottom:1.5rem;">[Instructor bio goes here]</div><button onclick="document.getElementById('bioOverlay').remove();" style="margin-top:0.6rem;background:#38bdf8;color:#112244;font-weight:bold;padding:0.55rem 1.4rem;border-radius:1rem;cursor:pointer;">Contact</button>`;
  overlay.appendChild(bubble);
  document.body.appendChild(overlay);
}

// Notification popup logic
document.getElementById('notifBtn')?.addEventListener('click', function() {
  const popup = document.getElementById('notifPopup');
  if(!popup) return;
  popup.style.display = popup.style.display === 'none' ? 'block' : 'none';
});

// Daily Notice Pop-up Logic
const dailyNoticeBtn = document.getElementById('dailyNoticeBtn');
const dailyNoticePopup = document.getElementById('dailyNoticePopup');
const closeNotice = document.getElementById('closeNotice');
const pinNotice = document.getElementById('pinNotice');

dailyNoticeBtn?.addEventListener('click', () => {
  dailyNoticePopup.classList.toggle('hidden');
});

closeNotice?.addEventListener('click', () => {
  dailyNoticePopup.classList.add('hidden');
});

pinNotice?.addEventListener('click', () => {
  if (dailyNoticePopup.classList.contains('fixed')) {
    dailyNoticePopup.classList.remove('fixed');
    dailyNoticePopup.classList.add('absolute');
    pinNotice.textContent = "üìå";
  } else {
    dailyNoticePopup.classList.remove('absolute');
    dailyNoticePopup.classList.add('fixed');
    pinNotice.textContent = "üìç";
  }
});

// Advanced Training Navigation functions
function goToScreenerTraining() {
  localStorage.setItem('activeSection', 'screen-ped-training');
  window.location.href = "/SMXKITS.html#screen-ped-training";
}

function goToIATraining() {
  localStorage.setItem('activeSection', 'screen-isr-training');
  window.location.href = "/SMXKITS.html#screen-isr-training";
}
</script>
    </div>
    <!-- Bottom bar for home screen -->
    <div class="bottom-bar">
      <div class="bottom-bar-left"></div>
      <a id="contactLink" class="inside-kit-link right-link" href="#">Contact&nbsp;SMXKITS</a>
    </div>
  </section>

  <!-- Import SMXKITS content sections -->
  <script>
    // Load SMXKITS.html content dynamically
    document.addEventListener('DOMContentLoaded', function() {
      fetch('/SMXKITS.html')
        .then(response => response.text())
        .then(html => {
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, 'text/html');
          
          // Get all sections from SMXKITS.html except screen-home and screen-login
          const sections = doc.querySelectorAll('section:not(#screen-home):not(#screen-login)');
          
          // Append them to this document
          sections.forEach(section => {
            document.body.appendChild(document.importNode(section, true));
          });
          
          // Now load any scripts that might be needed
          if (typeof initializeAllSections === 'function') {
            initializeAllSections();
          }
          
          // Force reload modules after dynamic content is loaded
          console.log('SMXKITS content loaded, forcing module reload');
          if (typeof loadModules === 'function') {
            setTimeout(loadModules, 1000);
          } else {
            console.error('loadModules function not available');
          }
        })
        .catch(error => {
          console.error('Error loading SMXKITS content:', error);
        });
    });
  </script>

  <script>
    // Display user information
    document.addEventListener('DOMContentLoaded', function() {
      const userName = localStorage.getItem('userName') || 'User';
      const role = localStorage.getItem('role') || 'Student';
      const userInfo = document.getElementById('user-info');
      if (userInfo) {
        userInfo.textContent = `${userName} (${role})`;
      }
    });

    // Logout function
    function logout() {
      // Clear all authentication data
      localStorage.removeItem('token');
      localStorage.removeItem('role');
      localStorage.removeItem('userName');
      localStorage.removeItem('classId');
      
      // Redirect to login page
      window.location.replace('/login.html');
    }

    // Navigation functions to ensure proper loading
    function goToKITS() {
      localStorage.setItem('activeSection', 'screen-dashboard');
      localStorage.setItem('forceModuleReload', 'true'); // Flag for forcing module reload
      window.location.href = "/SMXKITS.html#screen-dashboard";
    }
    
    function goToCourseContent() {
      localStorage.setItem('activeSection', 'screen-course-content');
      window.location.href = "/SMXKITS.html#screen-course-content";
    }
    
    function goToISRTraining() {
      localStorage.setItem('activeSection', 'screen-isr-training');
      window.location.href = "/SMXKITS.html#screen-isr-training";
    }
    
    function goToPEDTraining() {
      localStorage.setItem('activeSection', 'screen-ped-training');
      window.location.href = "/SMXKITS.html#screen-ped-training";
    }
    
    function goToOpsLog() {
      window.open('/OpsLog.html', '_blank');
    }
  </script>
  
  <!-- Include the main script file -->
  <script src="script.js"></script>
  
  <!-- Dashboard Specific Scripts -->
  <script>
    // Notification Bell Toggle
    document.getElementById('notifBtn')?.addEventListener('click', function() {
      const popup = document.getElementById('notifPopup');
      popup.classList.toggle('hidden');
    });
    
    // Close notification when clicking outside
    document.addEventListener('click', function(event) {
      const popup = document.getElementById('notifPopup');
      const btn = document.getElementById('notifBtn');
      
      if (!popup?.classList.contains('hidden') && 
          !popup?.contains(event.target) && 
          event.target !== btn) {
        popup?.classList.add('hidden');
      }
    });
    
    // Instructor Bio Popup
    function showInstructorBio(name) {
      // Create overlay
      if(document.getElementById('bioOverlay')) return;
      const overlay = document.createElement('div');
      overlay.id = 'bioOverlay';
      overlay.className = 'fixed inset-0 bg-black/80 z-50 flex items-center justify-center';
      
      // Create bio card
      const card = document.createElement('div');
      card.className = 'bg-zinc-900 rounded-2xl shadow-2xl p-8 max-w-md';
      
      // Placeholder content - replace with actual instructor data
      card.innerHTML = `
        <div class="flex items-start justify-between mb-4">
          <h2 class="text-xl font-bold text-white">${name}</h2>
          <button class="text-zinc-400 hover:text-white text-xl" id="closeBioBtn">√ó</button>
        </div>
        <div class="flex gap-4 mb-4">
          <img src="${name === 'Instructor 1' ? 'instructor1.jpg' : 'instructor2.jpg'}" 
               class="w-24 h-24 rounded-xl border-2 border-zinc-700" />
          <div>
            <div class="text-white font-semibold">Senior ISR Instructor</div>
            <div class="text-zinc-400 text-sm">10+ years experience</div>
          </div>
        </div>
        <p class="text-zinc-300 mb-4">
          Specialized in teaching advanced intelligence gathering techniques and real-time 
          surveillance operations. Former military intelligence officer with field experience.
        </p>
        <div class="text-blue-400 text-sm">Contact: instructor@smxkits.mil</div>
      `;
      
      overlay.appendChild(card);
      document.body.appendChild(overlay);
      
      // Add close functionality
      document.getElementById('closeBioBtn').addEventListener('click', () => {
        document.body.removeChild(overlay);
      });
      
      // Close on outside click
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
          document.body.removeChild(overlay);
        }
      });
    }
    
    // Set student name from localStorage if available
    document.addEventListener('DOMContentLoaded', function() {
      const studentNameEl = document.getElementById('studentName');
      const userName = localStorage.getItem('userName');
      if (studentNameEl && userName) {
        studentNameEl.textContent = userName;
      }
    });
  </script>
</body>
</html>