<!DOCTYPE html>
<html>
<head>
  <title>TrackPoint Tile Route Test</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
  <style>
    body { margin: 0; padding: 20px; font-family: Arial, sans-serif; }
    #map { height: 400px; width: 100%; border: 1px solid #ccc; margin: 20px 0; }
    .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
    .tile-test { margin: 10px 0; }
    .tile-test img { max-width: 256px; max-height: 256px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h1>TrackPoint Tile Loading Test</h1>
  
  <div class="test-section">
    <h2>Direct Tile Access Test</h2>
    <div class="tile-test">
      <h3>Tile: altis/0/0/0.png</h3>
      <img src="altis/0/0/0.png" alt="Tile 0/0/0" onload="console.log('Tile 0/0/0 loaded')" onerror="console.log('Tile 0/0/0 failed')">
    </div>
    <div class="tile-test">
      <h3>Tile: altis/2/0/0.png</h3>
      <img src="altis/2/0/0.png" alt="Tile 2/0/0" onload="console.log('Tile 2/0/0 loaded')" onerror="console.log('Tile 2/0/0 failed')">
    </div>
    <div class="tile-test">
      <h3>Tile: altis/2/1/1.png</h3>
      <img src="altis/2/1/1.png" alt="Tile 2/1/1" onload="console.log('Tile 2/1/1 loaded')" onerror="console.log('Tile 2/1/1 failed')">
    </div>
  </div>

  <div class="test-section">
    <h2>Standard Leaflet Map Test</h2>
    <div id="map"></div>
    <button onclick="testStandardMap()">Load Standard Map</button>
    <button onclick="testAltisMap()">Load Altis Map</button>
    <button onclick="testSimpleAltis()">Load Simple Altis</button>
    <button onclick="testBoundedAltis()">Load Bounded Altis</button>
    <button onclick="testSimpleInit()">Test Simple Init</button>
  </div>

  <div class="test-section">
    <h2>Debug Info</h2>
    <div id="debug-info"></div>
  </div>

  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
  <script src="https://unpkg.com/jquery@3.5.1/dist/jquery.min.js"></script>
  <script src="mapUtils.js"></script>
  <script src="defaultMap.js"></script>
  <script src="defaultMap-simple.js"></script>
  <script src="altis.js"></script>
  <script src="altis-simple.js"></script>
  
  <script>
    let map;
    
    function testStandardMap() {
      if (map) {
        map.remove();
      }
      
      map = L.map('map').setView([51.505, -0.09], 13);
      
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors'
      }).addTo(map);
      
      updateDebugInfo('Standard OpenStreetMap loaded');
    }
    
    function testAltisMap() {
      if (map) {
        map.remove();
      }
      
      try {
        // Test if Altis config is available
        if (typeof Arma3Map === 'undefined' || !Arma3Map.Maps.altis) {
          updateDebugInfo('ERROR: Arma3Map.Maps.altis not available');
          return;
        }
        
        const config = Arma3Map.Maps.altis;
        updateDebugInfo('Altis config loaded: ' + JSON.stringify(config, null, 2));
        
        // Create map with Altis settings
        map = L.map('map', {
          crs: config.CRS,
          minZoom: config.minZoom,
          maxZoom: config.maxZoom
        });
        
        // Add tile layer
        const tileLayer = L.tileLayer(config.tilePattern, {
          attribution: config.attribution,
          tileSize: config.tileSize,
          noWrap: true,
          bounds: [[0, 0], [30720, 30720]]
        });
        
        tileLayer.addTo(map);
        
        // Set view
        map.setView(config.center, config.defaultZoom);
        
        updateDebugInfo('Altis map initialized with center: ' + config.center + ', zoom: ' + config.defaultZoom);
        
        // Add tile load event listeners
        tileLayer.on('tileload', function(e) {
          console.log('Tile loaded:', e.url);
        });
        
        tileLayer.on('tileerror', function(e) {
          console.log('Tile error:', e.url);
          updateDebugInfo('Tile error: ' + e.url);
        });
        
      } catch (error) {
        updateDebugInfo('ERROR: ' + error.message);
        console.error(error);
      }
    }
    
    function testSimpleAltis() {
      if (map) {
        map.remove();
      }
      
      try {
        const config = Arma3Map.Maps.altisSimple;
        updateDebugInfo('Simple Altis config: ' + JSON.stringify(config, null, 2));
        
        map = L.map('map', {
          crs: config.CRS,
          minZoom: config.minZoom,
          maxZoom: config.maxZoom
        });
        
        const tileLayer = L.tileLayer(config.tilePattern, {
          attribution: config.attribution,
          tileSize: config.tileSize
        });
        
        tileLayer.addTo(map);
        map.setView(config.center, config.defaultZoom);
        
        updateDebugInfo('Simple Altis map loaded');
        
      } catch (error) {
        updateDebugInfo('Simple Altis ERROR: ' + error.message);
      }
    }
    
    function testBoundedAltis() {
      if (map) {
        map.remove();
      }
      
      try {
        const config = Arma3Map.Maps.altisBounded;
        updateDebugInfo('Bounded Altis config: ' + JSON.stringify(config, null, 2));
        
        map = L.map('map', {
          crs: config.CRS,
          minZoom: config.minZoom,
          maxZoom: config.maxZoom
        });
        
        const tileLayer = L.tileLayer(config.tilePattern, {
          attribution: config.attribution,
          tileSize: config.tileSize,
          bounds: config.bounds
        });
        
        tileLayer.addTo(map);
        map.fitBounds(config.bounds);
        
        updateDebugInfo('Bounded Altis map loaded');
        
      } catch (error) {
        updateDebugInfo('Bounded Altis ERROR: ' + error.message);
      }
    }
    
    function testSimpleInit() {
      if (map) {
        map.remove();
      }
      
      try {
        updateDebugInfo('Testing InitMapSimple with Altis config...');
        
        if (typeof InitMapSimple === 'function' && Arma3Map.Maps.altis) {
          map = InitMapSimple(Arma3Map.Maps.altis);
          updateDebugInfo('InitMapSimple completed successfully');
        } else {
          updateDebugInfo('ERROR: InitMapSimple or Altis config not available');
        }
        
      } catch (error) {
        updateDebugInfo('InitMapSimple ERROR: ' + error.message);
        console.error(error);
      }
    }
    
    function updateDebugInfo(message) {
      const debugDiv = document.getElementById('debug-info');
      debugDiv.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
    }
    
    // Test script loading
    document.addEventListener('DOMContentLoaded', function() {
      updateDebugInfo('Page loaded');
      
      if (typeof L !== 'undefined') {
        updateDebugInfo('Leaflet loaded: ' + L.version);
      } else {
        updateDebugInfo('ERROR: Leaflet not loaded');
      }
      
      if (typeof MGRS_CRS === 'function') {
        updateDebugInfo('MGRS_CRS function available');
      } else {
        updateDebugInfo('ERROR: MGRS_CRS function not available');
      }
      
      if (typeof Arma3Map !== 'undefined') {
        updateDebugInfo('Arma3Map available');
        if (Arma3Map.Maps && Arma3Map.Maps.altis) {
          updateDebugInfo('Altis config available');
        } else {
          updateDebugInfo('ERROR: Altis config not available');
        }
      } else {
        updateDebugInfo('ERROR: Arma3Map not available');
      }
    });
  </script>
</body>
</html>